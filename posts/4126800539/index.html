<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-my.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-my.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"crystal1213.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="本文主要讲述 Docker 相关的概念和命令。">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker">
<meta property="og:url" content="https://crystal1213.github.io/posts/4126800539/index.html">
<meta property="og:site_name" content="Crystal_Blog">
<meta property="og:description" content="本文主要讲述 Docker 相关的概念和命令。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201006003242500.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201006003359724.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201006011640397.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201006021818734.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201007152652541.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://i.loli.net/2021/04/08/y8npFVR2bsBtOHo.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201007153416751.png#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201007154257591.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://i.loli.net/2021/04/12/mbjcR2IhfMNJytx.png">
<meta property="og:image" content="https://i.loli.net/2021/04/12/H2jAe1K5uiWNDST.png">
<meta property="og:image" content="https://i.loli.net/2021/04/12/dU7jP2DoWyKY83p.png">
<meta property="og:image" content="https://i.loli.net/2021/04/12/XkcD3zE2nM8Pof5.png">
<meta property="og:image" content="https://i.loli.net/2021/04/12/uYQZGp6zVo7E1e8.png">
<meta property="og:image" content="https://i.loli.net/2021/04/12/FlRHONeAyrP6Epb.png">
<meta property="og:image" content="https://i.loli.net/2021/04/13/tZomW7qwdvRyLAl.png">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoZW5nY29kZXgvY2xvdWRpbWcvbWFzdGVyL2ltZy9pbWFnZS0yMDIwMDUxNjEyMjA0NzQ0MC5wbmc?x-oss-process=image/format,png">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoZW5nY29kZXgvY2xvdWRpbWcvbWFzdGVyL2ltZy9pbWFnZS0yMDIwMDUxNjEyMzM1NTAzNC5wbmc?x-oss-process=image/format,png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201008010537936.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201008010625708.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://i.loli.net/2021/04/14/UWoze869MB1ROLG.png">
<meta property="og:image" content="https://i.loli.net/2021/04/14/LGwJrtQsb3WI8O7.png">
<meta property="og:image" content="https://i.loli.net/2021/04/14/vdeOKJUwWBNr6Rz.png">
<meta property="og:image" content="https://i.loli.net/2021/04/14/sKlP8hadZACyQO7.png">
<meta property="og:image" content="https://i.loli.net/2021/04/14/Dflmr9FBXhjEdGw.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201009012255816.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201009012320547.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://i.loli.net/2021/04/14/ZUF6il1LR9C7sVB.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/2020100901260162.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://i.loli.net/2021/04/14/opzO2QDMlZSrnJK.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201009013411839.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201009022427614.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201009023523713.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/2020100902453233.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="article:published_time" content="2021-03-30T03:06:13.000Z">
<meta property="article:modified_time" content="2021-04-15T08:55:35.226Z">
<meta property="article:author" content="Crystal">
<meta property="article:tag" content="Docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img-blog.csdnimg.cn/20201006003242500.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center">

<link rel="canonical" href="https://crystal1213.github.io/posts/4126800539/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Docker | Crystal_Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Crystal_Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Crystal_Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">On the way, there will be more possibilities in the future.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">15</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">5</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">21</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://crystal1213.github.io/posts/4126800539/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.gif">
      <meta itemprop="name" content="Crystal">
      <meta itemprop="description" content="Guard heart, everything flows from it.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Crystal_Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Docker
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-03-30 11:06:13" itemprop="dateCreated datePublished" datetime="2021-03-30T11:06:13+08:00">2021-03-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-15 16:55:35" itemprop="dateModified" datetime="2021-04-15T16:55:35+08:00">2021-04-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>86k</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>本文主要讲述 Docker 相关的概念和命令。</p>
<a id="more"></a>

<h2 id="1-Docker-概述"><a href="#1-Docker-概述" class="headerlink" title="1 Docker 概述"></a>1 Docker 概述</h2><h3 id="1-1-基本认识"><a href="#1-1-基本认识" class="headerlink" title="1.1 基本认识"></a>1.1 基本认识</h3><p>Docker 基于 Go 语言开发</p>
<p>官方网站：<a target="_blank" rel="noopener" href="https://www.docker.com/">https://www.docker.com/</a><br>官方文档网站：<a target="_blank" rel="noopener" href="https://docs.docker.com/">https://docs.docker.com/</a><br>仓库地址：<a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a></p>
<p>Docker 和 虚拟机的不同：</p>
<ul>
<li>传统虚拟机，虚拟出一个硬件，运行一个完整的操作系统，然后在这个系统上安装和运行软件</li>
<li>容器内的应用直接运行在宿主机的内核，容器自己没有内核（属于内核级别的虚拟化），也没有虚拟机的硬件，所以就轻便了</li>
<li>每个容器间相互隔离，每个容器内都有一个属于自己的文件系统，互不影响</li>
</ul>
<h3 id="1-2-Docker-安装"><a href="#1-2-Docker-安装" class="headerlink" title="1.2 Docker 安装"></a>1.2 Docker 安装</h3><p><strong>镜像（Docker）:</strong><br>docker 镜像就好比一个模板，可以通过这个模板来创建容器服务，tomcat 镜像====&gt;run====&gt;tomcat01 容器（提供服务），通过这个镜像可以创建多个容器（最终服务运行或者项目运行就是在容器中）<br><strong>容器（container）:</strong><br>Docker 利用容器技术，独立运行一个或者一组应用，通过镜像来创建的。<br>容器会有一些命令：启动、停止、删除、基本命令<br>目前就可以把这个容器理为一个简易的 Linux 系统<br><strong>仓库（repository）：</strong><br>仓库就是存放镜像的地方！<br>仓库分为私有仓库和公有仓库！<br>Docker Hub（默认是国外的）<br>阿里云……都有容器服务器（配置镜像加速）</p>
<blockquote>
<p>基础知识</p>
</blockquote>
<ol>
<li>需要 Linux 基础</li>
<li>Centos 7</li>
<li>使用 xshell 连接远程的服务器</li>
</ol>
<blockquote>
<p>环境查看</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 系统内核 3.10 以上</span></span><br><span class="line">[root@test1 ~]# uname -r</span><br><span class="line">3.10.0-1160.el7.x86_64</span><br></pre></td></tr></table></figure>


<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 系统版本</span></span><br><span class="line">[root@test1 ~]# cat /etc/os-release </span><br><span class="line">NAME=&quot;CentOS Linux&quot;</span><br><span class="line">VERSION=&quot;7 (Core)&quot;</span><br><span class="line">ID=&quot;centos&quot;</span><br><span class="line">ID_LIKE=&quot;rhel fedora&quot;</span><br><span class="line">VERSION_ID=&quot;7&quot;</span><br><span class="line">PRETTY_NAME=&quot;CentOS Linux 7 (Core)&quot;</span><br><span class="line">ANSI_COLOR=&quot;0;31&quot;</span><br><span class="line">CPE_NAME=&quot;cpe:/o:centos:centos:7&quot;</span><br><span class="line">HOME_URL=&quot;https://www.centos.org/&quot;</span><br><span class="line">BUG_REPORT_URL=&quot;https://bugs.centos.org/&quot;</span><br><span class="line"></span><br><span class="line">CENTOS_MANTISBT_PROJECT=&quot;CentOS-7&quot;</span><br><span class="line">CENTOS_MANTISBT_PROJECT_VERSION=&quot;7&quot;</span><br><span class="line">REDHAT_SUPPORT_PRODUCT=&quot;centos&quot;</span><br><span class="line">REDHAT_SUPPORT_PRODUCT_VERSION=&quot;7&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>安装，参考官方文档：<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/centos/">https://docs.docker.com/engine/install/centos/</a></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 卸载旧版本</span></span><br><span class="line">sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 安装需要的安装包</span></span><br><span class="line">sudo yum install -y yum-utils</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 设置镜像的仓库</span></span><br><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo #（默认是国外的）</span><br><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo # 推荐使用阿里云的</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 更新 yum 软件包索引</span></span><br><span class="line">[root@test1 ~]# yum makecache fast</span><br><span class="line">已加载插件：fastestmirror, langpacks</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line">c7-media                                                                                        | 3.6 kB  00:00:00     </span><br><span class="line">docker-ce-stable                                                                                | 3.5 kB  00:00:00     </span><br><span class="line">(1/2): docker-ce-stable/7/x86_64/updateinfo                                                     |   55 B  00:00:02     </span><br><span class="line">(2/2): docker-ce-stable/7/x86_64/primary_db                                                     |  58 kB  00:00:03     </span><br><span class="line">元数据缓存已建立</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. 安装 docker 相关的东西  docker-ce 社区版 docker-ee 企业版</span></span><br><span class="line">sudo yum install docker-ce docker-ce-cli containerd.io</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 5. 启动 docker</span></span><br><span class="line">sudo systemctl start docker</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 6. 判断是否启动成功</span></span><br><span class="line">docker version</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 7. 运行 hello world 程序验证是否成功安装</span></span><br><span class="line">sudo docker run hello-world</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 8. 查看下载的 hello world 镜像</span></span><br><span class="line">[root@test1 ~]# docker images</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED       SIZE</span><br><span class="line">hello-world   latest    d1165f221234   3 weeks ago   13.3kB</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 了解下卸载 docker</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1. 卸载依赖</span></span><br><span class="line">sudo yum remove docker-ce docker-ce-cli containerd.io</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 删除资源（/var/lib/docker docker 默认工作路径）</span></span><br><span class="line">sudo rm -rf /var/lib/docker</span><br><span class="line">sudo rm -rf /var/lib/containerd</span><br></pre></td></tr></table></figure>
<blockquote>
<p>阿里云镜像加速</p>
</blockquote>
<ol>
<li>打开阿里云，找到容器镜像服务中的镜像加速器，参考链接：<a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors">https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors</a></li>
<li>执行如下操作：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line"></span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://uli2idx0.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="1-3-Docker-原理"><a href="#1-3-Docker-原理" class="headerlink" title="1.3 Docker 原理"></a>1.3 Docker 原理</h3><p><img src="https://img-blog.csdnimg.cn/20201006003242500.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center"></p>
<p>docker 工作原理：</p>
<ul>
<li>docker 是一个 Client-Server 结构的系统，docker 的守护进程运行在主机上，通过 socket 从客户端访问</li>
<li>dockerServer 接收 dockerClient 的指令，就会执行这个命令<br><img src="https://img-blog.csdnimg.cn/20201006003359724.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center"></li>
</ul>
<h2 id="2-docker-常用命令"><a href="#2-docker-常用命令" class="headerlink" title="2 docker 常用命令"></a>2 docker 常用命令</h2><h3 id="2-1-帮助命令"><a href="#2-1-帮助命令" class="headerlink" title="2.1 帮助命令"></a>2.1 帮助命令</h3><ul>
<li><code>docker version</code>：显示 docker 的版本信息</li>
<li><code>docker info</code>：显示 docker 的系统信息，包括镜像和容器的数量</li>
<li><code>docker 命令 --help</code>：帮助命令</li>
</ul>
<p>帮助文档的地址：<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/build/">https://docs.docker.com/engine/reference/commandline/build/</a></p>
<h3 id="2-2-镜像命令"><a href="#2-2-镜像命令" class="headerlink" title="2.2 镜像命令"></a>2.2 镜像命令</h3><ul>
<li><code>docker images</code>：查看主机上所有的镜像<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 ~]# docker images</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED       SIZE</span><br><span class="line">hello-world   latest    d1165f221234   3 weeks ago   13.3kB</span><br><span class="line"><span class="meta">#</span><span class="bash"> 解释</span></span><br><span class="line">REPOSITORY 镜像的仓库源</span><br><span class="line">TAG 镜像的标签</span><br><span class="line">IMAGE ID 镜像的 id</span><br><span class="line">CREATED 创建镜像的时间</span><br><span class="line">SIZE 镜像的地址</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 可选项</span></span><br><span class="line">-a, --all    # 列出所有的镜像</span><br><span class="line">-q, --quiet  # 只显示镜像的 id</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><code>docker search</code>：搜索镜像  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 执行下述命令和在 dockerhub 官网上进行搜索 mysql 一样</span></span><br><span class="line">[root@test1 ~]# docker search mysql</span><br><span class="line">NAME                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">mysql                             MySQL is a widely used, open-source relation…   10676     [OK]       </span><br><span class="line">mariadb                           MariaDB Server is a high performing open sou…   4010      [OK]       </span><br><span class="line">mysql/mysql-server                Optimized MySQL Server Docker images. Create…   780                  [OK]</span><br><span class="line">percona                           Percona Server is a fork of the MySQL relati…   529       [OK]       </span><br><span class="line">centos/mysql-57-centos7           MySQL 5.7 SQL database server                   87                   </span><br><span class="line">mysql/mysql-cluster               Experimental MySQL Cluster Docker images. Cr…   80                   </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="可选项，通过-STARS-来过滤"><a href="#可选项，通过-STARS-来过滤" class="headerlink" title="可选项，通过 STARS 来过滤"></a>可选项，通过 STARS 来过滤</h1>  -f, –filter filter   Filter output based on conditions provided<br>  –filter=STARS=3000   # 搜索出大于 3000 的镜像<br>  [root@test1 ~]# docker search –filter=STARS=3000 mysql<br>  NAME      DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED<br>  mysql     MySQL is a widely used, open-source relation…   10676     [OK]<br>  mariadb   MariaDB Server is a high performing open sou…   4010      [OK]   </li>
<li><code>docker pull</code>：下载镜像  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 下载镜像 docker pull 镜像名[:tag]，tag 在这里表示版本信息</span></span><br><span class="line">[root@test1 ~]# docker pull mysql</span><br><span class="line">Using default tag: latest # 如果不写 tag 默认就是最新的</span><br><span class="line">latest: Pulling from library/mysql</span><br><span class="line">a076a628af6f: Pull complete  # 分层下载， docker image 的核心；联合文件系统</span><br><span class="line">f6c208f3f991: Pull complete </span><br><span class="line">88a9455a9165: Pull complete </span><br><span class="line">406c9b8427c6: Pull complete </span><br><span class="line">7c88599c0b25: Pull complete </span><br><span class="line">25b5c6debdaf: Pull complete </span><br><span class="line">43a5816f1617: Pull complete </span><br><span class="line">1a8c919e89bf: Pull complete </span><br><span class="line">9f3cf4bd1a07: Pull complete </span><br><span class="line">80539cea118d: Pull complete </span><br><span class="line">201b3cad54ce: Pull complete </span><br><span class="line">944ba37e1c06: Pull complete </span><br><span class="line">Digest: sha256:feada149cb8ff54eade1336da7c1d080c4a1c7ed82b5e320efb5beebed85ae8c # 签名</span><br><span class="line">Status: Downloaded newer image for mysql:latest</span><br><span class="line">docker.io/library/mysql:latest #　真实地址</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 等价的两条命令：</span></span><br><span class="line">docker pull mysql</span><br><span class="line">docker pull docker.io/library/mysql:latest</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载指定版本的镜像，前提是该版本，即 tag，是存在的，可在 dockerhub 中查看镜像的版本</span></span><br><span class="line">[root@test1 ~]# docker pull mysql:5.7</span><br><span class="line">5.7: Pulling from library/mysql</span><br><span class="line">a076a628af6f: Already exists  # 已经存在的就不再下载了</span><br><span class="line">f6c208f3f991: Already exists </span><br><span class="line">88a9455a9165: Already exists </span><br><span class="line">406c9b8427c6: Already exists </span><br><span class="line">7c88599c0b25: Already exists </span><br><span class="line">25b5c6debdaf: Already exists </span><br><span class="line">43a5816f1617: Already exists </span><br><span class="line">1831ac1245f4: Pull complete </span><br><span class="line">37677b8c1f79: Pull complete </span><br><span class="line">27e4ac3b0f6e: Pull complete </span><br><span class="line">7227baa8c445: Pull complete </span><br><span class="line">Digest: sha256:b3d1eff023f698cd433695c9506171f0d08a8f92a0c8063c1a4d9db9a55808df</span><br><span class="line">Status: Downloaded newer image for mysql:5.7</span><br><span class="line">docker.io/library/mysql:5.7</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><code>docker rmi</code>：删除镜像  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   </span><br><span class="line">[root@test1 ~]# docker rmi -f 镜像id   # 删除指定的镜像</span><br><span class="line">[root@test1 ~]# docker rmi -f 镜像id 镜像id 镜像id 镜像id   # 删除指定的多个镜像</span><br><span class="line">[root@test1 ~]# docker rmi -f $(docker images -aq) # 删除全部的容器</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="2-3-容器命令"><a href="#2-3-容器命令" class="headerlink" title="2.3 容器命令"></a>2.3 容器命令</h3></li>
</ul>
<p>说明：有了镜像才能创建容器，在这里下载一个 centos 镜像来测试学习，执行命令 <code>docker pull centos</code></p>
<p><strong>新建容器并启动</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">docker run [可选参数] image</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 参数说明</span></span><br><span class="line">--name=&quot;Name&quot; 容器名字，例如：tomcat01、tomcat02，用来区分容器</span><br><span class="line">-d            后台方式运行</span><br><span class="line">-it           使用交互方式运行，进入容器查看内容</span><br><span class="line">-p            指定容器端口 例如： -p 8080:8080</span><br><span class="line">    -p ip:主机端口:容器端口</span><br><span class="line">    -p 主机端口:容器端口（常用）</span><br><span class="line">    -p 容器端口</span><br><span class="line">    容器端口</span><br><span class="line">-P            随机指定端口</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试，启动并进入容器bin</span></span><br><span class="line">[root@test1 ~]# docker run -it centos /bin/bash   （centos 这里表示容器，/bin/bash 表示控制台）</span><br><span class="line">[root@14afcd741d86 /]# ls    # 查看容器内的 centos，基础版本，很多命令都是不完善的</span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 从容器中退出</span></span><br><span class="line">[root@14afcd741d86 /]# exit</span><br><span class="line">exit</span><br><span class="line">[root@test1 ~]# ls</span><br><span class="line">123  anaconda-ks.cfg  deluser.sh  etc.tar.gz  exit1.sh  sh  top.log  useradd.sh  while1.sh</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>列出所有运行的容器：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">docker ps [选项]</span><br><span class="line">没有任何选项  # 列出当前正在运行的容器</span><br><span class="line">-a           # 列出当前正在运行的容器+带出历史运行过的容器</span><br><span class="line">-n=个数      # 显示最近创建的容器</span><br><span class="line">-q           # 只显示容器编号</span><br><span class="line"></span><br><span class="line">[root@test1 ~]#  docker ps -aq</span><br><span class="line">14afcd741d86</span><br><span class="line">e2b0e50d77f2</span><br><span class="line">[root@test1 ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line">[root@test1 ~]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND       CREATED          STATUS                     PORTS     NAMES</span><br><span class="line">14afcd741d86   centos         &quot;/bin/bash&quot;   10 minutes ago   Exited (0) 6 minutes ago             stoic_wiles</span><br><span class="line">e2b0e50d77f2   d1165f221234   &quot;/hello&quot;      15 hours ago     Exited (0) 15 hours ago              nervous_chaplygin</span><br><span class="line">[root@test1 ~]# docker ps -aq</span><br><span class="line">14afcd741d86</span><br><span class="line">e2b0e50d77f2</span><br></pre></td></tr></table></figure>

<p><strong>退出容器：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exit  # 容器停止并退出</span><br><span class="line">ctrl + P + Q  # 容器不停止退出 </span><br></pre></td></tr></table></figure>

<p><strong>删除容器：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker rm 容器id                  # 删除指定容器，不能删除正在运行的容器，如果要强制删除 rm -f</span><br><span class="line">docker rm -f $(docker ps -aq)    # 删除所有容器</span><br><span class="line">docker ps -aq | xargs docker rm  # 删除所有容器</span><br></pre></td></tr></table></figure>
<p><strong>启动和停止容器：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker start 容器id   # 启动容器</span><br><span class="line">docker restart 容器id # 重启容器</span><br><span class="line">docker stop 容器id    # 停止当前正在运行的容器</span><br><span class="line">docker kill 容器id    # 强制停止当前容器</span><br></pre></td></tr></table></figure>

<h3 id="2-4-常用其他命令"><a href="#2-4-常用其他命令" class="headerlink" title="2.4 常用其他命令"></a>2.4 常用其他命令</h3><p><strong>后台启动</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 后台启动镜像：docker run -d 镜像名</span></span><br><span class="line">[root@test1 ~]# docker run -d centos</span><br><span class="line">a7582d0faa59772930c78e65551788fe23b038a46216196dc8833663407e0fdc</span><br><span class="line">[root@test1 ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 通过 docker ps 命令查看当前正在运行的容器，发现 centos 停止了</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 简单解释：docker 容器使用后台运行，就必须要有一个前台的进程，docker 发现没有应用，就会自动停止</span></span><br></pre></td></tr></table></figure>

<p><strong>查看日志：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">命令：docker logs [选项] 容器id</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 自己编写一段 shell 脚本，首先后台启动镜像，并运行一个 shell 脚本</span></span><br><span class="line">[root@test1 ~]# docker run -d centos /bin/sh -c &quot;while true;do echo helloworld;sleep 1;done&quot;</span><br><span class="line">d5a331dd9feee7720fcef3c6051e57e424c8777e68ecf2755541d7e852cf3433</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看当前容器的 id</span></span><br><span class="line">[root@test1 ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS     NAMES</span><br><span class="line">d5a331dd9fee   centos    &quot;/bin/sh -c &#x27;while t…&quot;   8 seconds ago   Up 7 seconds             suspicious_hamilton</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示日志</span></span><br><span class="line"></span><br><span class="line">-tf           # 显示日志 -t 表示显示时间戳；-f 表示输出日志</span><br><span class="line">--tail 条数   # 指定显示日志的条数</span><br><span class="line">[root@test1 ~]# docker logs -tf --tail 10 d5a331dd9fee</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>显示容器中的进程信息</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">命令：docker top 容器id</span><br><span class="line">[root@test1 ~]# docker top --help</span><br><span class="line"></span><br><span class="line">Usage:  docker top CONTAINER [ps OPTIONS]</span><br><span class="line"></span><br><span class="line">Display the running processes of a container</span><br><span class="line">[root@test1 ~]# docker top d5a331dd9fee</span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</span><br><span class="line">root                5085                5064                0                   15:24               ?                   00:00:00            /bin/sh -c while true;do echo helloworld;sleep 1;done</span><br><span class="line">root                5768                5085                0                   15:34               ?                   00:00:00            /usr/bin/coreutils --coreutils-prog-shebang=sleep /usr/bin/sleep 1</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>查看镜像的元数据</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 命令</span></span><br><span class="line">docker inspect 容器id</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试</span></span><br><span class="line">[root@test1 ~]# docker inspect d5a331dd9fee </span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;d5a331dd9feee7720fcef3c6051e57e424c8777e68ecf2755541d7e852cf3433&quot;, # 容器id</span><br><span class="line">        &quot;Created&quot;: &quot;2021-03-31T07:24:34.295609291Z&quot;, # 创建时间</span><br><span class="line">        &quot;Path&quot;: &quot;/bin/sh&quot;, # 控制台</span><br><span class="line">        &quot;Args&quot;: [ # 所执行的操作</span><br><span class="line">            &quot;-c&quot;,</span><br><span class="line">            &quot;while true;do echo helloworld;sleep 1;done&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;State&quot;: &#123;</span><br><span class="line">            &quot;Status&quot;: &quot;running&quot;,</span><br><span class="line">            &quot;Running&quot;: true,</span><br><span class="line">            &quot;Paused&quot;: false,</span><br><span class="line">            &quot;Restarting&quot;: false,</span><br><span class="line">            &quot;OOMKilled&quot;: false,</span><br><span class="line">            &quot;Dead&quot;: false,</span><br><span class="line">            &quot;Pid&quot;: 5085,</span><br><span class="line">            &quot;ExitCode&quot;: 0,</span><br><span class="line">            &quot;Error&quot;: &quot;&quot;,</span><br><span class="line">            &quot;StartedAt&quot;: &quot;2021-03-31T07:24:35.173688374Z&quot;,</span><br><span class="line">            &quot;FinishedAt&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Image&quot;: &quot;sha256:300e315adb2f96afe5f0b2780b87f28ae95231fe3bdd1e16b9ba606307728f55&quot;,</span><br><span class="line">        &quot;ResolvConfPath&quot;: &quot;/var/lib/docker/containers/d5a331dd9feee7720fcef3c6051e57e424c8777e68ecf2755541d7e852cf3433/resolv.conf&quot;,</span><br><span class="line">        &quot;HostnamePath&quot;: &quot;/var/lib/docker/containers/d5a331dd9feee7720fcef3c6051e57e424c8777e68ecf2755541d7e852cf3433/hostname&quot;,</span><br><span class="line">        &quot;HostsPath&quot;: &quot;/var/lib/docker/containers/d5a331dd9feee7720fcef3c6051e57e424c8777e68ecf2755541d7e852cf3433/hosts&quot;,</span><br><span class="line">        &quot;LogPath&quot;: &quot;/var/lib/docker/containers/d5a331dd9feee7720fcef3c6051e57e424c8777e68ecf2755541d7e852cf3433/d5a331dd9feee7720fcef3c6051e57e424c8777e68ecf2755541d7e852cf3433-json.log&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;/suspicious_hamilton&quot;,</span><br><span class="line">        &quot;RestartCount&quot;: 0,</span><br><span class="line">        &quot;Driver&quot;: &quot;overlay2&quot;,</span><br><span class="line">        &quot;Platform&quot;: &quot;linux&quot;,</span><br><span class="line">        &quot;MountLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ProcessLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;AppArmorProfile&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ExecIDs&quot;: null,</span><br><span class="line">        &quot;HostConfig&quot;: &#123;</span><br><span class="line">            &quot;Binds&quot;: null,</span><br><span class="line">            &quot;ContainerIDFile&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LogConfig&quot;: &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;json-file&quot;,</span><br><span class="line">                &quot;Config&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;NetworkMode&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;PortBindings&quot;: &#123;&#125;,</span><br><span class="line">            &quot;RestartPolicy&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;no&quot;,</span><br><span class="line">                &quot;MaximumRetryCount&quot;: 0</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;AutoRemove&quot;: false,</span><br><span class="line">            &quot;VolumeDriver&quot;: &quot;&quot;,</span><br><span class="line">            &quot;VolumesFrom&quot;: null,</span><br><span class="line">            &quot;CapAdd&quot;: null,</span><br><span class="line">            &quot;CapDrop&quot;: null,</span><br><span class="line">            &quot;CgroupnsMode&quot;: &quot;host&quot;,</span><br><span class="line">            &quot;Dns&quot;: [],</span><br><span class="line">            &quot;DnsOptions&quot;: [],</span><br><span class="line">            &quot;DnsSearch&quot;: [],</span><br><span class="line">            &quot;ExtraHosts&quot;: null,</span><br><span class="line">            &quot;GroupAdd&quot;: null,</span><br><span class="line">            &quot;IpcMode&quot;: &quot;private&quot;,</span><br><span class="line">            &quot;Cgroup&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Links&quot;: null,</span><br><span class="line">            &quot;OomScoreAdj&quot;: 0,</span><br><span class="line">            &quot;PidMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Privileged&quot;: false,</span><br><span class="line">            &quot;PublishAllPorts&quot;: false,</span><br><span class="line">            &quot;ReadonlyRootfs&quot;: false,</span><br><span class="line">            &quot;SecurityOpt&quot;: null,</span><br><span class="line">            &quot;UTSMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;UsernsMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;ShmSize&quot;: 67108864,</span><br><span class="line">            &quot;Runtime&quot;: &quot;runc&quot;,</span><br><span class="line">            &quot;ConsoleSize&quot;: [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            &quot;Isolation&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpuShares&quot;: 0,</span><br><span class="line">            &quot;Memory&quot;: 0,</span><br><span class="line">            &quot;NanoCpus&quot;: 0,</span><br><span class="line">            &quot;CgroupParent&quot;: &quot;&quot;,</span><br><span class="line">            &quot;BlkioWeight&quot;: 0,</span><br><span class="line">            &quot;BlkioWeightDevice&quot;: [],</span><br><span class="line">            &quot;BlkioDeviceReadBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceReadIOps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteIOps&quot;: null,</span><br><span class="line">            &quot;CpuPeriod&quot;: 0,</span><br><span class="line">            &quot;CpuQuota&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimePeriod&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimeRuntime&quot;: 0,</span><br><span class="line">            &quot;CpusetCpus&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpusetMems&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Devices&quot;: [],</span><br><span class="line">            &quot;DeviceCgroupRules&quot;: null,</span><br><span class="line">            &quot;DeviceRequests&quot;: null,</span><br><span class="line">            &quot;KernelMemory&quot;: 0,</span><br><span class="line">            &quot;KernelMemoryTCP&quot;: 0,</span><br><span class="line">            &quot;MemoryReservation&quot;: 0,</span><br><span class="line">            &quot;MemorySwap&quot;: 0,</span><br><span class="line">            &quot;MemorySwappiness&quot;: null,</span><br><span class="line">            &quot;OomKillDisable&quot;: false,</span><br><span class="line">            &quot;PidsLimit&quot;: null,</span><br><span class="line">            &quot;Ulimits&quot;: null,</span><br><span class="line">            &quot;CpuCount&quot;: 0,</span><br><span class="line">            &quot;CpuPercent&quot;: 0,</span><br><span class="line">            &quot;IOMaximumIOps&quot;: 0,</span><br><span class="line">            &quot;IOMaximumBandwidth&quot;: 0,</span><br><span class="line">            &quot;MaskedPaths&quot;: [</span><br><span class="line">                &quot;/proc/asound&quot;,</span><br><span class="line">                &quot;/proc/acpi&quot;,</span><br><span class="line">                &quot;/proc/kcore&quot;,</span><br><span class="line">                &quot;/proc/keys&quot;,</span><br><span class="line">                &quot;/proc/latency_stats&quot;,</span><br><span class="line">                &quot;/proc/timer_list&quot;,</span><br><span class="line">                &quot;/proc/timer_stats&quot;,</span><br><span class="line">                &quot;/proc/sched_debug&quot;,</span><br><span class="line">                &quot;/proc/scsi&quot;,</span><br><span class="line">                &quot;/sys/firmware&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;ReadonlyPaths&quot;: [</span><br><span class="line">                &quot;/proc/bus&quot;,</span><br><span class="line">                &quot;/proc/fs&quot;,</span><br><span class="line">                &quot;/proc/irq&quot;,</span><br><span class="line">                &quot;/proc/sys&quot;,</span><br><span class="line">                &quot;/proc/sysrq-trigger&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;GraphDriver&quot;: &#123;</span><br><span class="line">            &quot;Data&quot;: &#123;</span><br><span class="line">                &quot;LowerDir&quot;: &quot;/var/lib/docker/overlay2/2b4531bf606a9e9283b131327a327f084f7cb8c37082b522e78ab3e3fcbe6e4a-init/diff:/var/lib/docker/overlay2/56bc5b165a12049d71a6c4ddb7fdb90c655273761c737f716ef7f8c757708304/diff&quot;,</span><br><span class="line">                &quot;MergedDir&quot;: &quot;/var/lib/docker/overlay2/2b4531bf606a9e9283b131327a327f084f7cb8c37082b522e78ab3e3fcbe6e4a/merged&quot;,</span><br><span class="line">                &quot;UpperDir&quot;: &quot;/var/lib/docker/overlay2/2b4531bf606a9e9283b131327a327f084f7cb8c37082b522e78ab3e3fcbe6e4a/diff&quot;,</span><br><span class="line">                &quot;WorkDir&quot;: &quot;/var/lib/docker/overlay2/2b4531bf606a9e9283b131327a327f084f7cb8c37082b522e78ab3e3fcbe6e4a/work&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Name&quot;: &quot;overlay2&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Mounts&quot;: [],</span><br><span class="line">        &quot;Config&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;d5a331dd9fee&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: false,</span><br><span class="line">            &quot;AttachStdout&quot;: false,</span><br><span class="line">            &quot;AttachStderr&quot;: false,</span><br><span class="line">            &quot;Tty&quot;: false,</span><br><span class="line">            &quot;OpenStdin&quot;: false,</span><br><span class="line">            &quot;StdinOnce&quot;: false,</span><br><span class="line">            &quot;Env&quot;: [</span><br><span class="line">                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Cmd&quot;: [</span><br><span class="line">                &quot;/bin/sh&quot;,</span><br><span class="line">                &quot;-c&quot;,</span><br><span class="line">                &quot;while true;do echo helloworld;sleep 1;done&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Image&quot;: &quot;centos&quot;,</span><br><span class="line">            &quot;Volumes&quot;: null,</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Entrypoint&quot;: null,</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: &#123;</span><br><span class="line">                &quot;org.label-schema.build-date&quot;: &quot;20201204&quot;,</span><br><span class="line">                &quot;org.label-schema.license&quot;: &quot;GPLv2&quot;,</span><br><span class="line">                &quot;org.label-schema.name&quot;: &quot;CentOS Base Image&quot;,</span><br><span class="line">                &quot;org.label-schema.schema-version&quot;: &quot;1.0&quot;,</span><br><span class="line">                &quot;org.label-schema.vendor&quot;: &quot;CentOS&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;NetworkSettings&quot;: &#123;</span><br><span class="line">            &quot;Bridge&quot;: &quot;&quot;,</span><br><span class="line">            &quot;SandboxID&quot;: &quot;64c148e4e8f015b106faf51865504d2d42793f341221c7451af79ad2b78dfcb7&quot;,</span><br><span class="line">            &quot;HairpinMode&quot;: false,</span><br><span class="line">            &quot;LinkLocalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LinkLocalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;Ports&quot;: &#123;&#125;,</span><br><span class="line">            &quot;SandboxKey&quot;: &quot;/var/run/docker/netns/64c148e4e8f0&quot;,</span><br><span class="line">            &quot;SecondaryIPAddresses&quot;: null,</span><br><span class="line">            &quot;SecondaryIPv6Addresses&quot;: null,</span><br><span class="line">            &quot;EndpointID&quot;: &quot;780f596dee4f87b2052c149d3955aad60f989183bb86ed2bf92e22206ae5ab72&quot;,</span><br><span class="line">            &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">            &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line">            &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">            &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">            &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">            &quot;Networks&quot;: &#123;</span><br><span class="line">                &quot;bridge&quot;: &#123;</span><br><span class="line">                    &quot;IPAMConfig&quot;: null,</span><br><span class="line">                    &quot;Links&quot;: null,</span><br><span class="line">                    &quot;Aliases&quot;: null,</span><br><span class="line">                    &quot;NetworkID&quot;: &quot;36e5e549da2d55e9d1cddf9bd6a247f4456b390233c5b9a441844bfcab4ca697&quot;,</span><br><span class="line">                    &quot;EndpointID&quot;: &quot;780f596dee4f87b2052c149d3955aad60f989183bb86ed2bf92e22206ae5ab72&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line">                    &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">                    &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">                    &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">                    &quot;DriverOpts&quot;: null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>进入当前正在运行的容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 我们通常容器都是使用后台方式运行的，需要进入容器，修改一些配置</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 命令</span></span><br><span class="line">docker exec -it 容器id bashShell</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">测试</span></span><br><span class="line">[root@test1 ~]# docker exec -it d5a331dd9fee /bin/bash</span><br><span class="line">[root@d5a331dd9fee /]# ls</span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示当前进程的状态</span></span><br><span class="line">[root@d5a331dd9fee /]# ps -ef</span><br><span class="line">UID         PID   PPID  C STIME TTY          TIME CMD</span><br><span class="line">root          1      0  0 07:24 ?        00:00:01 /bin/sh -c while true;do echo helloworld;sleep 1;done</span><br><span class="line">root       1531      0  0 07:50 pts/0    00:00:00 /bin/bash</span><br><span class="line">root       1606      1  0 07:51 ?        00:00:00 /usr/bin/coreutils --coreutils-prog-shebang=sleep /usr/bin/sleep 1</span><br><span class="line">root       1607   1531  0 07:51 pts/0    00:00:00 ps -ef</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 方法二</span></span><br><span class="line">docker attach 容器id</span><br><span class="line"></span><br><span class="line">[root@test1 ~]# docker attach d5a331dd9fee </span><br><span class="line">正在执行当前的代码。。</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker <span class="built_in">exec</span>   <span class="comment"># 进入容器后开启一个新的终端，可以在里面操作（常用）</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker attach <span class="comment"># 进入容器正在执行的终端，不会启动新进程</span></span></span><br></pre></td></tr></table></figure>

<p><strong>从容器拷贝内容到主机（注意：拷贝工作是在主机上进行的）</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 命令</span></span><br><span class="line">docker cp 容器id:容器路径 目的主机路径</span><br><span class="line"></span><br><span class="line">[root@test1 ~]# docker run -it centos /bin/bash</span><br><span class="line">[root@5a5fb8c5ee5c /]# [root@test1 ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS          PORTS     NAMES</span><br><span class="line">5a5fb8c5ee5c   centos    &quot;/bin/bash&quot;   13 seconds ago   Up 11 seconds             jolly_cray</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入容器</span> </span><br><span class="line">[root@test1 ~]# docker attach 5a5fb8c5ee5c </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在容器中创建文件</span></span><br><span class="line">[root@5a5fb8c5ee5c /]# cd /home</span><br><span class="line">[root@5a5fb8c5ee5c home]# touch test.java</span><br><span class="line">[root@5a5fb8c5ee5c home]# exit</span><br><span class="line">exit</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入主机，将文件拷贝出来</span></span><br><span class="line">[root@test1 ~]# cd /home</span><br><span class="line">[root@test1 home]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED         STATUS                      PORTS     NAMES</span><br><span class="line">5a5fb8c5ee5c   centos    &quot;/bin/bash&quot;   2 minutes ago   Exited (0) 27 seconds ago             jolly_cray</span><br><span class="line">[root@test1 home]# docker cp 5a5fb8c5ee5c:/home/test.java /home</span><br><span class="line">[root@test1 home]# ls</span><br><span class="line">lost+found  test.java</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-5-常用命令小结"><a href="#2-5-常用命令小结" class="headerlink" title="2.5 常用命令小结"></a>2.5 常用命令小结</h3><p><img src="https://img-blog.csdnimg.cn/20201006011640397.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center"></p>
<table>
<thead>
<tr>
<th>命令</th>
<th>英文描述</th>
<th>中文意思</th>
</tr>
</thead>
<tbody><tr>
<td>attach</td>
<td>Attach to a running container</td>
<td>当前shell下attach连接指定运行镜像</td>
</tr>
<tr>
<td>build</td>
<td>Build an image from a Dockerfile</td>
<td>通过Dockerfile定制镜像</td>
</tr>
<tr>
<td>commit</td>
<td>Create a new image from a container changes</td>
<td>提交当前容器为新的境像</td>
</tr>
<tr>
<td>cp</td>
<td>copy files/folders from the containers filesystem to the host path</td>
<td>从容器中拷贝指定文件或者目录到宿主机中</td>
</tr>
<tr>
<td>create</td>
<td>Create a new container</td>
<td>创建一个新的容器，同run.但不启动容器</td>
</tr>
<tr>
<td>diff</td>
<td>Inspect changes on a container’s filesystem</td>
<td>查看docker容器变化</td>
</tr>
<tr>
<td>events</td>
<td>Get real time events from the server</td>
<td>从docker服务中获取容器实时事件</td>
</tr>
<tr>
<td>export</td>
<td>Stream the contents of a container as a tar archive</td>
<td>导出容器的内容流作为一个 tar归档文件[对应import]</td>
</tr>
<tr>
<td>history</td>
<td>Show the history of an image</td>
<td>展示一个境像形成历史</td>
</tr>
<tr>
<td>images</td>
<td>List images</td>
<td>列出系统当前所有镜像</td>
</tr>
<tr>
<td>import</td>
<td>Create a new filesystem image from the contents of a tarball</td>
<td>从tar包中的内容创建一个新的文件系统映像[对应export]</td>
</tr>
<tr>
<td>info</td>
<td>Display system-wide information</td>
<td>显示系统相关信息</td>
</tr>
<tr>
<td>inspect</td>
<td>Return low-level information on a container</td>
<td>查看容器详细信息</td>
</tr>
<tr>
<td>kill</td>
<td>Kill a running container</td>
<td>kill指定docker容器</td>
</tr>
<tr>
<td>load</td>
<td>Load an image from a tar archive</td>
<td>从—个 tar包中加载一个镜像[对应save]</td>
</tr>
<tr>
<td>login</td>
<td>Register or Login to the docker registry server</td>
<td>注册或者登陆一个docker源服务器</td>
</tr>
<tr>
<td>logout</td>
<td>Log out from a Docker registry server</td>
<td>从当前Docker registry退出</td>
</tr>
<tr>
<td>logs</td>
<td>Fetch the logs of a container</td>
<td>输出当前容器日志信息</td>
</tr>
<tr>
<td>port</td>
<td>Lookup the public-facing port which is NAT-ed to PRIVATE_PORT</td>
<td>查看映射端口对应的容器内部源端</td>
</tr>
<tr>
<td>pause</td>
<td>Pause all processes within a container</td>
<td>暂停容器</td>
</tr>
<tr>
<td>ps</td>
<td>List containers</td>
<td>列出容器列表</td>
</tr>
<tr>
<td>pull</td>
<td>Pull an image or a repository from the docker registry server</td>
<td>从docker镜像服务器中拉取指定镜像或者库镜像</td>
</tr>
<tr>
<td>push</td>
<td>push an image or a repository to the docker registry server</td>
<td>推送指定镜像或者库镜像至docker源服务器</td>
</tr>
<tr>
<td>restart</td>
<td>Restart a running container</td>
<td>重启运行的容器</td>
</tr>
<tr>
<td>rm</td>
<td>Remove one or more containers</td>
<td>移除—个或者多个容器</td>
</tr>
<tr>
<td>rmi</td>
<td>Remove one or more images</td>
<td>移除一个或多个境像[无容器使用该镜像才可删除，否则需删除相关容器才可能继续或者 -f 强制删除</td>
</tr>
<tr>
<td>run</td>
<td>Run a command in a new container</td>
<td>创建—个新的容器并运行一个命令</td>
</tr>
<tr>
<td>save</td>
<td>Save an image to a tar arehive</td>
<td>保存一个镜像为—个tar包「对应load]</td>
</tr>
<tr>
<td>search</td>
<td>Search for an image on the Docker Hub</td>
<td>在docker hub中搜索镜像</td>
</tr>
<tr>
<td>start</td>
<td>start a stopped containers</td>
<td>启动容器</td>
</tr>
<tr>
<td>stop</td>
<td>stop a stopped containers</td>
<td>停止容器</td>
</tr>
<tr>
<td>tag</td>
<td>Tag an image into a repository</td>
<td>给源中镜像打标签</td>
</tr>
<tr>
<td>top</td>
<td>Lookup the running processes of a container</td>
<td>查看容器中运行的进程信息</td>
</tr>
<tr>
<td>unpause</td>
<td>Unpause a paused container</td>
<td>取消暂停容器</td>
</tr>
<tr>
<td>version</td>
<td>show the docker version information</td>
<td>查看docker版本号</td>
</tr>
<tr>
<td>wait</td>
<td>Block until a container stops，then print its exit code</td>
<td>截取容器停止时的退出状态值</td>
</tr>
</tbody></table>
<h3 id="2-6-练习"><a href="#2-6-练习" class="headerlink" title="2.6 练习"></a>2.6 练习</h3><blockquote>
<p>练习一：Docker 安装 Nginx</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 搜索镜像 docker search nginx 可以在 dockerhub 搜索，清晰的看到版本号等相关的信息</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 下载镜像 docker pull nginx</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 测试</span></span><br><span class="line">[root@test1 home]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">nginx        latest    f6d0b4767a6c   2 months ago   133MB</span><br><span class="line">centos       latest    300e315adb2f   3 months ago   209MB</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> -d 后台运行</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --name 给容器命名</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -p 宿主机端口：容器内部端口</span></span><br><span class="line">[root@test1 home]# docker run -d --name nginx01 -p 3344:80 nginx</span><br><span class="line">9727ac01094f32b8fb115620956f8fd6662e3affd5cdfb70f033be4ffd2ad348</span><br><span class="line">[root@test1 home]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS                  NAMES</span><br><span class="line">9727ac01094f   nginx     &quot;/docker-entrypoint.…&quot;   7 seconds ago   Up 5 seconds   0.0.0.0:3344-&gt;80/tcp   nginx01</span><br><span class="line"><span class="meta">#</span><span class="bash"> 模拟浏览器访问</span></span><br><span class="line">[root@test1 home]# curl localhost:3344</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    body &#123;</span><br><span class="line">        width: 35em;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">        font-family: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;For online documentation and support please refer to</span><br><span class="line">&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span><br><span class="line">Commercial support is available at</span><br><span class="line">&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入容器</span></span><br><span class="line">[root@test1 home]# docker exec -it nginx01 /bin/bash</span><br><span class="line">root@9727ac01094f:/# whereis nginx</span><br><span class="line">nginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginx</span><br><span class="line">root@9727ac01094f:/# cd /etc/nginx</span><br><span class="line">root@9727ac01094f:/etc/nginx# ls</span><br><span class="line">conf.d	fastcgi_params	koi-utf  koi-win  mime.types  modules  nginx.conf  scgi_params	uwsgi_params  win-utf</span><br><span class="line">root@9727ac01094f:/etc/nginx# </span><br><span class="line"> </span><br></pre></td></tr></table></figure>
<p>端口暴露的概念：<br><img src="https://img-blog.csdnimg.cn/20201006021818734.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center"></p>
<p>思考问题：我们每次改动 nginx 配置文件，都需要进入容器内部？十分麻烦，要是可以在容器外部提供一个映射路径，达到在容器修改文件名，容器内部就可以自动修改？用 -v 数据卷技术</p>
<blockquote>
<p>练习二：docker 安装 tomcat</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 官方的使用</span></span><br><span class="line">docker run -it --rm tomcat:9.0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 我们之前的启动都是后台，停止了容器之后，容器还是可以使用 docker ps 命令，查到 docker run -it --rm 一般用来测试，用完就删除</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载最新版镜像</span></span><br><span class="line">[root@test1 home]# docker pull tomcat</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/tomcat</span><br><span class="line">Digest: sha256:94cc18203335e400dbafcd0633f33c53663b1c1012a13bcad58cced9cd9d1305</span><br><span class="line">Status: Downloaded newer image for tomcat:latest</span><br><span class="line">docker.io/library/tomcat:latest</span><br><span class="line">[root@test1 home]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">tomcat       9.0       040bdb29ab37   2 months ago   649MB</span><br><span class="line">tomcat       latest    040bdb29ab37   2 months ago   649MB</span><br><span class="line">nginx        latest    f6d0b4767a6c   2 months ago   133MB</span><br><span class="line">centos       latest    300e315adb2f   4 months ago   209MB</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在后台运行</span></span><br><span class="line">[root@test1 home]# docker run -d -p 3355:8080 --name tomcat01 tomcat</span><br><span class="line">5b6abd353d3e80fce67f543d6d0be5987da12f3987009518379f015fbbb8c16d</span><br><span class="line"><span class="meta">#</span><span class="bash"> 此时可以访问：http://192.168.137.4:3355/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入容器</span></span><br><span class="line">[root@test1 home]# docker exec -it tomcat01 /bin/bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 发现问题：</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1.Linux命令少了；2. webapps 文件夹是空的；主要是阿里云镜像的原因，默认是最小的镜像，所有不必要的都删了</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 解决方法：</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入容器后将 webapps.dist 文件夹下的内容拷贝到 webapps 中，再次访问 http://192.168.137.4:3355/ 就可以正常显示页面了</span></span><br><span class="line">root@5b6abd353d3e:/usr/local/tomcat# ls ./webapps</span><br><span class="line">root@5b6abd353d3e:/usr/local/tomcat# ls ./webapps.dist</span><br><span class="line">ROOT  docs  examples  host-manager  manager</span><br><span class="line"><span class="meta">#</span><span class="bash"> 拷贝命令</span></span><br><span class="line">root@5b6abd353d3e:/usr/local/tomcat# cp -r ./webapps.dist/* ./webapps</span><br><span class="line">root@5b6abd353d3e:/usr/local/tomcat# ls ./webapps.dist</span><br><span class="line">ROOT  docs  examples  host-manager  manager</span><br><span class="line">root@5b6abd353d3e:/usr/local/tomcat# </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>练习三：docker 部署 es + kibana</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> es--&gt;elasticsearch 暴露的端口很多</span> </span><br><span class="line"><span class="meta">#</span><span class="bash"> es 十分耗内存</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> es 的数据一般需要放置在安全目录</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动 elasticsearch</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --net somenetwork 网络配置；-e 环境配置</span></span><br><span class="line">docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; elasticsearch:7.12.0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动后，linux 变得非常卡，可用 docker stats 查看 cpu 的状态</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> es 十分耗内存</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 cpu 的状态</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试 es 是否成功  未成功！！！！</span></span><br><span class="line">[root@test1 home]# curl localhost:9300</span><br><span class="line">curl: (56) Recv failure: Connection reset by peer</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 关闭 es，增加内存的限制</span></span><br></pre></td></tr></table></figure>





<h3 id="2-7-可视化"><a href="#2-7-可视化" class="headerlink" title="2.7 可视化"></a>2.7 可视化</h3><p><strong>portainer:</strong><br>Docker 图形化界面管理工具！提供一个后台面板供我们操作</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8088:9000 --restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer</span><br></pre></td></tr></table></figure>
<p>访问测试：<a target="_blank" rel="noopener" href="http://192.168.137.4:8088/">http://192.168.137.4:8088</a> 访问该链接可看到可视化的页面（平时不会使用）</p>
<h2 id="3-Docker-镜像讲解"><a href="#3-Docker-镜像讲解" class="headerlink" title="3 Docker 镜像讲解"></a>3 Docker 镜像讲解</h2><h3 id="3-1-Docker-镜像是什么"><a href="#3-1-Docker-镜像是什么" class="headerlink" title="3.1 Docker 镜像是什么"></a>3.1 Docker 镜像是什么</h3><p>镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含运行某个软件所需的所有内容，包括代码、运行时的库、环境变量和配置文件。</p>
<p>所有的应用，直接打包 docker 镜像，就可以直接跑起来！</p>
<p><strong>如何得到镜像：</strong></p>
<ul>
<li>从远程仓库下载</li>
<li>朋友拷贝</li>
<li>自己制作一个镜像 Dockerfile</li>
</ul>
<h3 id="3-2-Docker-镜像加载原理"><a href="#3-2-Docker-镜像加载原理" class="headerlink" title="3.2 Docker 镜像加载原理"></a>3.2 Docker 镜像加载原理</h3><blockquote>
<p>UnionFS（联合文件系统）</p>
</blockquote>
<p>下载镜像的时候，看到的一层一层的就是联合文件系统。</p>
<p>UnionFS（联合文件系统）：Union 文件系统是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层一层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下（unite several direcotries into a single virtual filesystem）。Union 文件系统是 Docker 镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。</p>
<p>特性：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录。</p>
<blockquote>
<p>Docker 镜像加载原理</p>
</blockquote>
<p>docker 镜像实际上由一层一层的文件系统组成，这种层级的文件系统是 UnionFS。</p>
<p>bootfs(boot file system)主要包含 bootloader 和 kernel，bootloader 主要是引导加载 kernel，Linux 刚启动时会加载 bootfs 文件系统，在 docker 镜像最底层的是 bootfs。这一层与我们典型的 Linux/Unix 系统是一样的，包含 boot 加载器和内核。当 boot 加载完成之后整个内核就都在内存中，此时内存的使用权已由 bootfs 转交给内核，此时系统也会卸载 bootfs。</p>
<p>rootfs(root file system)，在 bootfs 之上，包含的就是典型 Linux 系统中的 /dev, /proc, /bin, /etc 等标准目录和文件。rootfs 就是各种不同的操作系统发行版，比如 Ubuntu、Centos 等等。<br><img src="https://img-blog.csdnimg.cn/20201007152652541.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center"></p>
<p>Q:为什么安装进虚拟机的 Centos 都是好几个G，为什么 Docker 只有几百 MB？<br>A:对于一个精简的 OS，rootfs 可以很小，只需要包含最基本的命令、工具和程序就可以了，因为底层直接用 Host 的 Kernel，自己只需要提供 rootfs 就可以了。由此可见对于不同的 Linux 发行版，bootfs 基本是一致的，rootfs 会有差别，因此不同的发行版可以共用 bootfs。</p>
<p>虚拟机是分钟级别启动，容器是秒级启动。</p>
<h3 id="3-3-分层理解"><a href="#3-3-分层理解" class="headerlink" title="3.3 分层理解"></a>3.3 分层理解</h3><blockquote>
<p>分层的镜像</p>
</blockquote>
<p>为什么 docker 镜像要采用这种分层的结构呢？<br><img src="https://i.loli.net/2021/04/08/y8npFVR2bsBtOHo.png" alt="image.png"></p>
<ul>
<li>资源共享，例如：多个镜像都是从相同的 Base 镜像构建而来的，那么宿主机只需要在磁盘上保留一份 Base 镜像，同时内存中也只需要加载一份 Base 镜像，这样就可以为所有的容器服务，而且每一层都可以被共享。就像上图中的第一项，就是 Base 镜像，说明已经存在了，就不用下载了。</li>
<li>查看镜像分层方式，可用命令 <code>docker image inspect 镜像名</code>，例如：<code>docker image inspect redis</code></li>
</ul>
<p><strong>所有的 Docker 镜像都起始于一个基础镜像层，当进行修改或增加新的内容时，就会在当前镜像层之上，创建新的镜像层。</strong></p>
<p><strong>特点：</strong><br>Docker 镜像都是只读的，当容器启动时，一个新的可写层被加载到镜像的顶部，这一层就是通常说的容器层，容器之下叫镜像。<br><img src="https://img-blog.csdnimg.cn/20201007153416751.png#pic_center"></p>
<h3 id="3-4-commit-镜像"><a href="#3-4-commit-镜像" class="headerlink" title="3.4 commit 镜像"></a>3.4 commit 镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker commit 提交容器成为一个新的副本</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 命令和 git 原理类似</span></span><br><span class="line">docker commit -m=&quot;提交的描述信息&quot; -a=&quot;作者&quot; 容器id 目标镜像名[:TAG]</span><br></pre></td></tr></table></figure>

<p>实战测试</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 启动一个默认的 tomcat</span></span><br><span class="line">docker run -d -p 3355:8080 --name tomcat02 tomcat</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 发现这个默认的 tomcat 是没有 webapps 应用，是镜像的原因，官方镜像默认 webapps 下是没有文件的！</span></span><br><span class="line">docker exec -it tomcat02 /bin/bash</span><br><span class="line">cp -r ./webapps.dist/* ./webapps</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 自己将基本的文件拷贝进去</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. 将我们操作过的容器通过 commit 提交为一个镜像！以后就可以使用修改过的镜像</span></span><br><span class="line">docker commit -m=&quot;append new application&quot; -a=&quot;yyf&quot; 5b6abd353d3e tomcat:1.0</span><br><span class="line">可通过：docker images 查看新提交的镜像</span><br></pre></td></tr></table></figure>

<p>说明：如果想要保存当前容器的状态，就可以通过 commit 来提交，获得一个镜像，就好比我们之间学习 VM 的时候，快照。</p>
<h2 id="4-容器数据卷"><a href="#4-容器数据卷" class="headerlink" title="4 容器数据卷"></a>4 容器数据卷</h2><h3 id="4-1-什么是容器数据卷"><a href="#4-1-什么是容器数据卷" class="headerlink" title="4.1 什么是容器数据卷"></a>4.1 什么是容器数据卷</h3><p><strong>Docker 理念：</strong> 将应用和环境打包成一个镜像，如果数据都在容器中，那么当我们容器被删除的时候，数据就会丢失。==需求：数据可以持久化。== 例如：MySQL 数据库，当容器删除后，数据库内的数据可以存储在本地。</p>
<p><strong>卷技术：</strong> 容器之间可以有一个数据共享的技术，Docker 容器中产生的数据可以同步到本地。</p>
<p><strong>目录的挂载：</strong> 将容器内的目录挂载到 Linux 上。<br><img src="https://img-blog.csdnimg.cn/20201007154257591.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center"></p>
<p><strong>总结：</strong> 容器的持久化和同步操作，容器间也是数据共享的。</p>
<h3 id="4-2-使用书卷"><a href="#4-2-使用书卷" class="headerlink" title="4.2 使用书卷"></a>4.2 使用书卷</h3><blockquote>
<p>方式一：使用命令挂载</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 挂载命令：</span></span><br><span class="line">docker run -it -v 主机目录：容器内目录 容器名 控制台</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试：</span></span><br><span class="line">[root@test1 ~]# docker run -it -v /home/ceshi:/home centos /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动后可以通过命令 docker inspect 容器id 来查看，如下图所示</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2021/04/12/mbjcR2IhfMNJytx.png" alt="image.png"></p>
<p>测试：在主机目录下新建文件 test.java，容器内目录也会同步显示。当然，容器内目录新建文件或者对文件做一些操作，主机目录中也会同步。</p>
<p><img src="https://i.loli.net/2021/04/12/H2jAe1K5uiWNDST.png" alt="image.png"></p>
<p>说明：容器关闭时，在主机目录中对文件进行修改，容器内的目录也会同步。因此，容器关闭并不影响数据的同步。</p>
<h3 id="4-3-实战：安装-MySQL"><a href="#4-3-实战：安装-MySQL" class="headerlink" title="4.3 实战：安装 MySQL"></a>4.3 实战：安装 MySQL</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 拉取镜像</span></span><br><span class="line">[root@test1 home]# docker pull mysql:5.7</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 运行容器</span></span><br><span class="line">-d 表示后台运行</span><br><span class="line">-p 表示端口映射</span><br><span class="line">-v 表示卷挂载，可同时映射多个目录</span><br><span class="line">-e 表示环境配置，这里是设置 root 用户登录的密码</span><br><span class="line">--name 表示容器的名字</span><br><span class="line">[root@test1 ~]# docker run -d -p 3310:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 启动成功以后，可以使用 Navicate 远程连接数据库，如下图所示</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2021/04/12/dU7jP2DoWyKY83p.png" alt="image.png"></p>
<p>在 navicate 新建一个数据库进行测试：<br><img src="https://i.loli.net/2021/04/12/XkcD3zE2nM8Pof5.png" alt="image.png"></p>
<p>同时，可以看到在 /home/mysql/data 目录中会显示相应的数据库：<br><img src="https://i.loli.net/2021/04/12/uYQZGp6zVo7E1e8.png" alt="image.png"></p>
<p>测试在删掉 mysql01 容器的情况下，不会影响数据库中的数据：<br><img src="https://i.loli.net/2021/04/12/FlRHONeAyrP6Epb.png" alt="image.png"></p>
<h3 id="4-4-具名挂载和匿名挂载"><a href="#4-4-具名挂载和匿名挂载" class="headerlink" title="4.4 具名挂载和匿名挂载"></a>4.4 具名挂载和匿名挂载</h3><p><strong>匿名挂载：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 挂载方式：-v 容器内路径</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> -P：采用默认的端口暴露</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -v 容器内路径：匿名挂载</span></span><br><span class="line">[root@test1 ~]# docker run -d -P --name nginx01 -v /etc/nginx nginx</span><br><span class="line">a6625d8e688f09397d57c31fc4498acabf5a61255617d1480c63d352190b8265</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看所有的卷，可以看到这里的卷是没有名字的</span></span><br><span class="line">[root@test1 ~]# docker volume ls</span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     1d961328bb70a51fa792beb0311fef5e9a5e0d9d31f80649bcb160ccf9163841</span><br><span class="line">local     66dd06779d66e0e4290e4b8e4c6a50e35bb67d469bef36d25f0495fdc7ae635c</span><br><span class="line">local     81e259356c416fcedd649a0f696b39017d4f8d34d5523e030b9f545d52dc7908</span><br><span class="line">local     0487ccc9df8d22819be77a17da0929b1d2fa25daf5c4599fb8e7a387ab2a715b</span><br><span class="line">local     c6b9e19160a5201de006a955ec122fa4ef870c99d28d964026607b38ad46345c</span><br><span class="line">local     f9c92ba70342ee21126e4ecaad32b6cd6c0503723da74ba619bb3457cb49364a</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>查看卷相关的信息：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 ~]# docker volume --help</span><br><span class="line"></span><br><span class="line">Usage:  docker volume COMMAND</span><br><span class="line"></span><br><span class="line">Manage volumes</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  create      Create a volume  # 创建卷</span><br><span class="line">  inspect     Display detailed information on one or more volumes # 查看卷的一些细节信息</span><br><span class="line">  ls          List volumes # 查看所有的卷</span><br><span class="line">  prune       Remove all unused local volumes # 移除所有未使用的卷</span><br><span class="line">  rm          Remove one or more volumes # 移除卷</span><br><span class="line"></span><br><span class="line">Run &#x27;docker volume COMMAND --help&#x27; for more information on a command.</span><br></pre></td></tr></table></figure>

<p><strong>具名挂载：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 挂载方式：-v 卷名:容器内路径</span></span><br><span class="line">[root@test1 ~]# docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx nginx</span><br><span class="line">3c982b8aa4a1d10a0e4c853be6975cd8972d8ef4dace24dd6584f470b63fceb8</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看所有卷，可以看到会列举出卷名 juming-nginx</span></span><br><span class="line">[root@test1 ~]# docker volume ls</span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     1d961328bb70a51fa792beb0311fef5e9a5e0d9d31f80649bcb160ccf9163841</span><br><span class="line">local     66dd06779d66e0e4290e4b8e4c6a50e35bb67d469bef36d25f0495fdc7ae635c</span><br><span class="line">local     81e259356c416fcedd649a0f696b39017d4f8d34d5523e030b9f545d52dc7908</span><br><span class="line">local     0487ccc9df8d22819be77a17da0929b1d2fa25daf5c4599fb8e7a387ab2a715b</span><br><span class="line">local     c6b9e19160a5201de006a955ec122fa4ef870c99d28d964026607b38ad46345c</span><br><span class="line">local     f9c92ba70342ee21126e4ecaad32b6cd6c0503723da74ba619bb3457cb49364a</span><br><span class="line">local     juming-nginx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看卷 juming-nginx 的详细信息</span></span><br><span class="line">[root@test1 ~]# docker volume inspect juming-nginx</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;CreatedAt&quot;: &quot;2021-04-13T08:52:54+08:00&quot;,  # 创建时间</span><br><span class="line">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Labels&quot;: null,</span><br><span class="line">        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/juming-nginx/_data&quot;, # 对应的主机目录</span><br><span class="line">        &quot;Name&quot;: &quot;juming-nginx&quot;,</span><br><span class="line">        &quot;Options&quot;: null,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>说明：具名挂载在没有指定主机具体目录的情况下，默认在 /var/lib/docker/volumes/xxx/_data 下</p>
<p><strong>指定路径挂载：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 挂载方式：-v 主机路径:容器内路径</span></span><br><span class="line">[root@test1 ~]# docker run -d -P -v /home/nginx03:/etc/nginx --name nginx03 nginx</span><br><span class="line">0e2400adfc611595401b589011fbc66bde50625a916e2a0b2cf1f1a8c2848f58</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如何区别不同的挂载方式？</p>
<ul>
<li>匿名挂载：<code>-v 容器内路径</code></li>
<li>具名挂载：<code>-v 卷名:容器内路径</code></li>
<li>指定路径挂载：<code>-v /宿主机路径:容器内路径</code></li>
</ul>
<p><strong>扩展：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 指定挂在后的读写权限：-v 容器内路径:ro/rw</span></span><br><span class="line">ro readonly # 只读，说明这个路径只能通过宿主机来操作，容器内部是无法操作的</span><br><span class="line">rw readwrite # 可读可写</span><br><span class="line"></span><br><span class="line">docker run -d  -p --name  nginx02  -v  juming-nginx:/etc/nginx:ro  nginx</span><br><span class="line">docker run -d  -p --name  nginx02  -v  juming-nginx:/etc/nginx:rw  nginx </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="5-DockerFile"><a href="#5-DockerFile" class="headerlink" title="5 DockerFile"></a>5 DockerFile</h2><h3 id="5-1-初识-DockerFile"><a href="#5-1-初识-DockerFile" class="headerlink" title="5.1 初识 DockerFile"></a>5.1 初识 DockerFile</h3><blockquote>
<p>方式二：使用创建 Dockerfile 文件的方式挂载</p>
</blockquote>
<p>Dockerfile 是用来创建 docker 镜像的文件，是一个命令脚本，脚本是一个一个的命令。每个命令都是一层。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 在 home 目录下创建一个 docker-test-volume 目录，用于存放脚本测试文件</span></span><br><span class="line">[root@test1 ~]# mkdir /home/docker-test-volume</span><br><span class="line">[root@test1 ~]# cd /home/docker-test-volume</span><br><span class="line">[root@test1 docker-test-volume]# vi Dockerfile1</span><br><span class="line"><span class="meta">#</span><span class="bash"> Dockerfile1 文件的内容</span></span><br><span class="line">[root@test1 docker-test-volume]# cat Dockerfile1</span><br><span class="line">FROM centos</span><br><span class="line"></span><br><span class="line">VOLUME [&quot;volume01&quot;,&quot;volume02&quot;]</span><br><span class="line"></span><br><span class="line">CMD echo &quot;-------------end-----------&quot;</span><br><span class="line"></span><br><span class="line">CMD /bin/bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 构建脚本生成镜像</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -f：通过什么文件来构建，后面接文件的地址</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -t：生成文件的版本</span></span><br><span class="line">[root@test1 docker-test-volume]# docker build -f /home/docker-test-volume/Dockerfile1 -t yyf/centos:1.0 .</span><br><span class="line">Sending build context to Docker daemon  2.048kB</span><br><span class="line">Step 1/4 : FROM centos</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 300e315adb2f</span></span><br><span class="line">Step 2/4 : VOLUME [&quot;volume01&quot;,&quot;volume02&quot;]</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 7a6be75293d6</span></span><br><span class="line">Removing intermediate container 7a6be75293d6</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 0245345f7b05</span></span><br><span class="line">Step 3/4 : CMD echo &quot;-------------end-----------&quot;</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 7cd2968c8dda</span></span><br><span class="line">Removing intermediate container 7cd2968c8dda</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 0e4cd4a61dd3</span></span><br><span class="line">Step 4/4 : CMD /bin/bash</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 6d990114a9f1</span></span><br><span class="line">Removing intermediate container 6d990114a9f1</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 940136b6990a</span></span><br><span class="line">Successfully built 940136b6990a</span><br><span class="line">Successfully tagged yyf/centos:1.0</span><br><span class="line">[root@test1 docker-test-volume]# docker images</span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">yyf/centos            1.0       940136b6990a   16 seconds ago   209MB</span><br><span class="line">mysql                 5.7       450379344707   2 days ago       449MB</span><br><span class="line">tomcat                1.0       24fc4b5f8938   3 days ago       654MB</span><br><span class="line">tomcat                latest    c82f1a6ba61f   3 days ago       654MB</span><br><span class="line">redis                 latest    621ceef7494a   2 months ago     104MB</span><br><span class="line">tomcat                9.0       040bdb29ab37   2 months ago     649MB</span><br><span class="line">nginx                 latest    f6d0b4767a6c   3 months ago     133MB</span><br><span class="line">centos                latest    300e315adb2f   4 months ago     209MB</span><br><span class="line">portainer/portainer   latest    62771b0b9b09   8 months ago     79.1MB</span><br><span class="line">elasticsearch         latest    5acf0e8da90b   2 years ago      486MB</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 启动容器，可看到最下面的两个文件就是生成镜像时自动挂载的，该卷挂载的方式是匿名挂载的</span></span><br><span class="line">[root@test1 docker-test-volume]# docker run -it 940136b6990a /bin/bash</span><br><span class="line">[root@567d36c57e75 /]# ls -l</span><br><span class="line">total 60</span><br><span class="line">lrwxrwxrwx.   1 root root    7 Nov  3 15:22 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x.   5 root root  360 Apr 13 02:01 dev</span><br><span class="line">drwxr-xr-x.   1 root root 4096 Apr 13 02:01 etc</span><br><span class="line">drwxr-xr-x.   2 root root 4096 Nov  3 15:22 home</span><br><span class="line">lrwxrwxrwx.   1 root root    7 Nov  3 15:22 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx.   1 root root    9 Nov  3 15:22 lib64 -&gt; usr/lib64</span><br><span class="line">drwx------.   2 root root 4096 Dec  4 17:37 lost+found</span><br><span class="line">drwxr-xr-x.   2 root root 4096 Nov  3 15:22 media</span><br><span class="line">drwxr-xr-x.   2 root root 4096 Nov  3 15:22 mnt</span><br><span class="line">drwxr-xr-x.   2 root root 4096 Nov  3 15:22 opt</span><br><span class="line">dr-xr-xr-x. 116 root root    0 Apr 13 02:01 proc</span><br><span class="line">dr-xr-x---.   2 root root 4096 Dec  4 17:37 root</span><br><span class="line">drwxr-xr-x.  11 root root 4096 Dec  4 17:37 run</span><br><span class="line">lrwxrwxrwx.   1 root root    8 Nov  3 15:22 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x.   2 root root 4096 Nov  3 15:22 srv</span><br><span class="line">dr-xr-xr-x.  13 root root    0 Apr 13 00:36 sys</span><br><span class="line">drwxrwxrwt.   7 root root 4096 Dec  4 17:37 tmp</span><br><span class="line">drwxr-xr-x.  12 root root 4096 Dec  4 17:37 usr</span><br><span class="line">drwxr-xr-x.  20 root root 4096 Dec  4 17:37 var</span><br><span class="line">drwxr-xr-x.   2 root root 4096 Apr 13 02:01 volume01</span><br><span class="line">drwxr-xr-x.   2 root root 4096 Apr 13 02:01 volume02</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. 在 volume01 文件夹下新建文件，查看主机中对应的文件夹中是否同步，可通过命令 docker inspect 容器id 来查看对应到哪个文件夹（Mounts），参考下图</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在容器内</span></span><br><span class="line">[root@e1778df61bf0 /]# ls ./volume01</span><br><span class="line">[root@e1778df61bf0 /]# cd ./volume01</span><br><span class="line">[root@e1778df61bf0 volume01]# ls</span><br><span class="line">[root@e1778df61bf0 volume01]# touch container.txt</span><br><span class="line">[root@e1778df61bf0 volume01]# ls</span><br><span class="line">container.txt</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在主机内</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看容器 id</span></span><br><span class="line">[root@test1 ~]# docker ps</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看对应主机中的目录</span></span><br><span class="line">[root@test1 ~]# docker inspect e1778df61bf0 </span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入目录查看是否有文件</span></span><br><span class="line">[root@test1 ~]# cd /var/lib/docker/volumes/16c5c8842b55289a1661c4bc59b146e4ad4800b19a03b038a9da40d6a176</span><br><span class="line">[root@test1 _data]# ls</span><br><span class="line">container.txt</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2021/04/13/tZomW7qwdvRyLAl.png" alt="image.png"></p>
<p><strong>结论：</strong> 这种方式使用的非常多，因为我们通常会构建自己的镜像。如果构建镜像的时候没有挂载卷，这时候就需要手动挂载，需要使用 <code>-v 卷名：容器内路径</code></p>
<h3 id="5-2-数据卷容器"><a href="#5-2-数据卷容器" class="headerlink" title="5.2 数据卷容器"></a>5.2 数据卷容器</h3><p>多个 mysql 同步数据，通过容器挂载数据卷的方式实现。<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoZW5nY29kZXgvY2xvdWRpbWcvbWFzdGVyL2ltZy9pbWFnZS0yMDIwMDUxNjEyMjA0NzQ0MC5wbmc?x-oss-process=image/format,png"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 实现方式 --volumes-from 容器列表</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1. 启动第一个容器 docker01</span></span><br><span class="line">[root@test1 docker-test-volume]# docker run -it --name docker01 yyf/centos:1.0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. ctrl + P + Q 让这个容器后台运行</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 启动第二个容器，让第二个容器能够和第一个容器 docker02</span></span><br><span class="line">[root@test1 docker-test-volume]# docker run -it --name docker02 --volumes-from docker01 yyf/centos:1.0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. 在第二个容器中的 volume01 中创建文件，第一个容器相应的目录中同步显示</span></span><br><span class="line">[root@2b292e87621f /]# cd volume01</span><br><span class="line">[root@2b292e87621f volume01]# ls</span><br><span class="line">[root@2b292e87621f volume01]# touch test.txt</span><br><span class="line">[root@2b292e87621f volume01]# ls</span><br><span class="line">test.txt</span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入第一个正在运行的容器，使用命令 docker attach 容器id</span></span><br><span class="line">[root@test1 docker-test-volume]# docker attach a679336e3fbc</span><br><span class="line">[root@a679336e3fbc /]# cd volume01</span><br><span class="line">[root@a679336e3fbc volume01]# ls</span><br><span class="line">test.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>测试：删除 docker01 后，容器 docker02 中的数据依然存在。因此，不同容器中的共享卷是一个拷贝的存在形式，也就是在每一个容器中都有一个共享卷，而不是只有一份。如下图所示：<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoZW5nY29kZXgvY2xvdWRpbWcvbWFzdGVyL2ltZy9pbWFnZS0yMDIwMDUxNjEyMzM1NTAzNC5wbmc?x-oss-process=image/format,png"></p>
<p>多个 MySQL 实现数据同步：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 3306:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7</span><br><span class="line">docker run -d -p 3307:3306 -e MYSQL_ROOT_PASSWORD=123456 --name mysql02 --volumes-from mysql01  mysql:5.7</span><br><span class="line"><span class="meta">#</span><span class="bash"> 这个时候，可以实现两个容器数据同步！</span></span><br></pre></td></tr></table></figure>

<p><strong>结论：</strong><br>容器之间配置信息的传递，数据卷容器的生命周期一直持续到没有容器为止。但是一旦持久化到了本地，这时候，本地的数据是不会删除的！</p>
<h3 id="5-3-DockerFile-介绍"><a href="#5-3-DockerFile-介绍" class="headerlink" title="5.3 DockerFile 介绍"></a>5.3 DockerFile 介绍</h3><p>DockerFile 是用来构建 docker 镜像的文件，是一个命令参数脚本。<br>构建步骤：</p>
<ol>
<li>编写一个 dockerfile 文件</li>
<li>docker build 构建成为镜像</li>
<li>docker run 运行镜像</li>
<li>docker push 发布镜像（DockerHub、阿里云镜像）</li>
</ol>
<p>在 dockerhub 中搜索镜像名，点击版本名可进入对应的 github，里面写了 Dockerfile：<br><img src="https://img-blog.csdnimg.cn/20201008010537936.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center"></p>
<p>很多官方的镜像都是基础包，很多功能都没有，我们通常会搭建自己的镜像。<br>另外，官方既然可以制作镜像，我们也可以构建自己的镜像。</p>
<h3 id="5-4-DockerFile-构建过程"><a href="#5-4-DockerFile-构建过程" class="headerlink" title="5.4 DockerFile 构建过程"></a>5.4 DockerFile 构建过程</h3><p>基础知识：</p>
<ul>
<li>每个保留关键字（指令）都必须是大写字母</li>
<li>执行顺序是从上往下依次执行</li>
<li><code>#</code> 表示注释</li>
<li>每一个指令都会创建提交一个新的镜像层，并提交</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20201008010625708.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center"></p>
<p>DockerFile 是面向开发的，以后要发布项目、做镜像，就需要编写 dockerfile 文件。</p>
<p>步骤：开发、部署、运维…缺一不可</p>
<ul>
<li>DockerFile：构建文件，定义了一切步骤，源代码；</li>
<li>DockerImages：通过 DockerFile 构建生成的镜像，最终发布和运行的产品；</li>
<li>Docker 容器：容器就是镜像运行起来提供服务器。</li>
</ul>
<h3 id="5-5-DockerFile-的指令"><a href="#5-5-DockerFile-的指令" class="headerlink" title="5.5 DockerFile 的指令"></a>5.5 DockerFile 的指令</h3><p>可以使用以下指令，自己写一个镜像！</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">FROM # 指定基础镜像，一切都是从这里开始</span><br><span class="line">MAINTAINER # 指定维护者信息，【镜像是谁写的，】姓名&lt;邮箱&gt;</span><br><span class="line">RUN # 镜像构建的时候需要运行的命令，【你想要镜像做什么】</span><br><span class="line">ADD # 步骤，添加内容</span><br><span class="line">WORKDIR # 镜像的工作目录</span><br><span class="line">VOLUME # 挂载的目录</span><br><span class="line">EXPOSE # 暴露端口配置</span><br><span class="line">CMD # 指定这个容器启动的时候要运行的命令，只有最后一个会生效，可被替代</span><br><span class="line">ENTRYPOINT # 指定这个容器启动的时候要运行的命令，可以追加命令</span><br><span class="line">ONBUILD # 当构建一个被继承， Dockerfile 这个时候就会运行 ONBUILD 的指令，触发指令</span><br><span class="line">COPY # 类似 ADD，将我们文件拷贝到镜像中</span><br><span class="line">ENV # 构建的时候设置环境变量</span><br></pre></td></tr></table></figure>
<h3 id="5-6-实战测试：构建自己的-Centos"><a href="#5-6-实战测试：构建自己的-Centos" class="headerlink" title="5.6 实战测试：构建自己的 Centos"></a>5.6 实战测试：构建自己的 Centos</h3><p>Docker Hub 中大部分镜像都是从基础镜像 <code>FROM scratch</code> 过来的的，然后再进行需要的软件和配置来构建。</p>
<p>官方镜像中，没有 <code>ifconfig</code>、<code>vim</code> 这些指令，而且进入容器后进入到的是根目录。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 home]# docker run -it  centos /bin/bash</span><br><span class="line">[root@2a7b83543e82 /]# pwd</span><br><span class="line">/</span><br><span class="line">[root@2a7b83543e82 /]# ifconfig</span><br><span class="line">bash: ifconfig: command not found</span><br><span class="line">[root@2a7b83543e82 /]# vim</span><br><span class="line">bash: vim: command not found</span><br><span class="line">[root@2a7b83543e82 /]# exit</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>

<p>构建自己的 Centos：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 创建目录 dockerfile，在目录下创建自己的 mydockerfile-centos 文件</span></span><br><span class="line">[root@test1 home]# mkdir dockerfile</span><br><span class="line">[root@test1 home]# ls</span><br><span class="line">ceshi  dockerfile  docker-test-volume  lost+found  mysql  nginx03  test.java</span><br><span class="line">[root@test1 home]# cd dockerfile</span><br><span class="line">[root@test1 dockerfile]# vim mydockerfile-centos</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. mydockerfile-centos 文件的内容：</span></span><br><span class="line">[root@test1 home]# cat ./dockerfile/mydockerfile-centos </span><br><span class="line">FROM centos # 基于本地的 centos</span><br><span class="line">MAINTAINER yyf&lt;1436058432@qq.com&gt; # 作者的信息</span><br><span class="line">ENV MYPAHT /usr/local # 设置环境变量</span><br><span class="line">WORKDIR $MYPAHT # 配置进入容器后的默认工作路径</span><br><span class="line">RUN yum -y install vim # 构建镜像时安装 vim</span><br><span class="line">RUN yum -y install net-tools # 构建镜像时安装 net-tools</span><br><span class="line">EXPOSE 80 # 暴露 80 端口</span><br><span class="line">CMD echo $MYPATH # 容器启动时的打印信息</span><br><span class="line">CMD echo &quot;------------END------------------&quot; # 容器启动时的打印信息</span><br><span class="line">CMD /bin/bash # 容器启动时的控制台</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 构建镜像，使用命令 docker build -f dockerfile文件路径 -t 镜像名[:tag] .</span></span><br><span class="line">[root@test1 dockerfile]# docker build -f mydockerfile-centos -t mycentos:0.1 .</span><br><span class="line">Sending build context to Docker daemon  2.048kB</span><br><span class="line">Step 1/10 : FROM centos</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 300e315adb2f</span></span><br><span class="line">Step 2/10 : MAINTAINER yyf&lt;1436058432@qq.com&gt;</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 034be25dfb3f</span></span><br><span class="line">Removing intermediate container 034be25dfb3f</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 46b753499dca</span></span><br><span class="line">Step 3/10 : ENV MYPAHT /usr/local</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 8b9366076fe6</span></span><br><span class="line">Removing intermediate container 8b9366076fe6</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 61afbed96e00</span></span><br><span class="line">Step 4/10 : WORKDIR $MYPAHT</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 8c29c4f3e238</span></span><br><span class="line">Removing intermediate container 8c29c4f3e238</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 5824b7855a72</span></span><br><span class="line">Step 5/10 : RUN yum -y install vim</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> cd5e48d462e2</span></span><br><span class="line">CentOS Linux 8 - AppStream                      356 kB/s | 6.3 MB     00:18    </span><br><span class="line">CentOS Linux 8 - BaseOS                         185 kB/s | 2.3 MB     00:12    </span><br><span class="line">CentOS Linux 8 - Extras                         3.6 kB/s | 9.6 kB     00:02    </span><br><span class="line">Dependencies resolved.</span><br><span class="line">================================================================================</span><br><span class="line"> Package             Arch        Version                   Repository      Size</span><br><span class="line">================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> vim-enhanced        x86_64      2:8.0.1763-15.el8         appstream      1.4 M</span><br><span class="line">Installing dependencies:</span><br><span class="line"> gpm-libs            x86_64      1.20.7-15.el8             appstream       39 k</span><br><span class="line"> vim-common          x86_64      2:8.0.1763-15.el8         appstream      6.3 M</span><br><span class="line"> vim-filesystem      noarch      2:8.0.1763-15.el8         appstream       48 k</span><br><span class="line"> which               x86_64      2.21-12.el8               baseos          49 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">================================================================================</span><br><span class="line">Install  5 Packages</span><br><span class="line"></span><br><span class="line">Total download size: 7.8 M</span><br><span class="line">Installed size: 30 M</span><br><span class="line">Downloading Packages:</span><br><span class="line">(1/5): gpm-libs-1.20.7-15.el8.x86_64.rpm         31 kB/s |  39 kB     00:01    </span><br><span class="line">(2/5): vim-filesystem-8.0.1763-15.el8.noarch.rp  68 kB/s |  48 kB     00:00    </span><br><span class="line">(3/5): vim-enhanced-8.0.1763-15.el8.x86_64.rpm  191 kB/s | 1.4 MB     00:07    </span><br><span class="line">(4/5): which-2.21-12.el8.x86_64.rpm             7.1 kB/s |  49 kB     00:06    </span><br><span class="line">(5/5): vim-common-8.0.1763-15.el8.x86_64.rpm    416 kB/s | 6.3 MB     00:15    </span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Total                                           465 kB/s | 7.8 MB     00:17     </span><br><span class="line">warning: /var/cache/dnf/appstream-02e86d1c976ab532/packages/gpm-libs-1.20.7-15.eld: NOKEY</span><br><span class="line">CentOS Linux 8 - AppStream                      240 kB/s | 1.6 kB     00:00    </span><br><span class="line">Importing GPG key 0x8483C65D:</span><br><span class="line"> Userid     : &quot;CentOS (CentOS Official Signing Key) &lt;security@centos.org&gt;&quot;</span><br><span class="line"> Fingerprint: 99DB 70FA E1D7 CE22 7FB6 4882 05B5 55B3 8483 C65D</span><br><span class="line"> From       : /etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">Key imported successfully</span><br><span class="line">Running transaction check</span><br><span class="line">Transaction check succeeded.</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded.</span><br><span class="line">Running transaction</span><br><span class="line">  Preparing        :                                                        1/1 </span><br><span class="line">  Installing       : which-2.21-12.el8.x86_64                               1/5 </span><br><span class="line">  Installing       : vim-filesystem-2:8.0.1763-15.el8.noarch                2/5 </span><br><span class="line">  Installing       : vim-common-2:8.0.1763-15.el8.x86_64                    3/5 </span><br><span class="line">  Installing       : gpm-libs-1.20.7-15.el8.x86_64                          4/5 </span><br><span class="line">  Running scriptlet: gpm-libs-1.20.7-15.el8.x86_64                          4/5 </span><br><span class="line">  Installing       : vim-enhanced-2:8.0.1763-15.el8.x86_64                  5/5 </span><br><span class="line">  Running scriptlet: vim-enhanced-2:8.0.1763-15.el8.x86_64                  5/5 </span><br><span class="line">  Running scriptlet: vim-common-2:8.0.1763-15.el8.x86_64                    5/5 </span><br><span class="line">  Verifying        : gpm-libs-1.20.7-15.el8.x86_64                          1/5 </span><br><span class="line">  Verifying        : vim-common-2:8.0.1763-15.el8.x86_64                    2/5 </span><br><span class="line">  Verifying        : vim-enhanced-2:8.0.1763-15.el8.x86_64                  3/5 </span><br><span class="line">  Verifying        : vim-filesystem-2:8.0.1763-15.el8.noarch                4/5 </span><br><span class="line">  Verifying        : which-2.21-12.el8.x86_64                               5/5 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  gpm-libs-1.20.7-15.el8.x86_64         vim-common-2:8.0.1763-15.el8.x86_64    </span><br><span class="line">  vim-enhanced-2:8.0.1763-15.el8.x86_64 vim-filesystem-2:8.0.1763-15.el8.noarch</span><br><span class="line">  which-2.21-12.el8.x86_64             </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">Removing intermediate container cd5e48d462e2</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 55aec80889eb</span></span><br><span class="line">Step 6/10 : RUN yum -y install net-tools</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 64ac8b3bd196</span></span><br><span class="line">Last metadata expiration check: 0:00:45 ago on Tue Apr 13 12:51:49 2021.</span><br><span class="line">Dependencies resolved.</span><br><span class="line">================================================================================</span><br><span class="line"> Package         Architecture Version                        Repository    Size</span><br><span class="line">================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> net-tools       x86_64       2.0-0.52.20160912git.el8       baseos       322 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">================================================================================</span><br><span class="line">Install  1 Package</span><br><span class="line"></span><br><span class="line">Total download size: 322 k</span><br><span class="line">Installed size: 942 k</span><br><span class="line">Downloading Packages:</span><br><span class="line">net-tools-2.0-0.52.20160912git.el8.x86_64.rpm   334 kB/s | 322 kB     00:00    </span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Total                                           165 kB/s | 322 kB     00:01     </span><br><span class="line">Running transaction check</span><br><span class="line">Transaction check succeeded.</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded.</span><br><span class="line">Running transaction</span><br><span class="line">  Preparing        :                                                        1/1 </span><br><span class="line">  Installing       : net-tools-2.0-0.52.20160912git.el8.x86_64              1/1 </span><br><span class="line">  Running scriptlet: net-tools-2.0-0.52.20160912git.el8.x86_64              1/1 </span><br><span class="line">  Verifying        : net-tools-2.0-0.52.20160912git.el8.x86_64              1/1 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  net-tools-2.0-0.52.20160912git.el8.x86_64                                     </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">Removing intermediate container 64ac8b3bd196</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 3cd01c2f1f7f</span></span><br><span class="line">Step 7/10 : EXPOSE 80</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 5bf88c16c59e</span></span><br><span class="line">Removing intermediate container 5bf88c16c59e</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 8ce51dd41328</span></span><br><span class="line">Step 8/10 : CMD echo $MYPATH</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> c31038e4e332</span></span><br><span class="line">Removing intermediate container c31038e4e332</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> dcfb832ea5e4</span></span><br><span class="line">Step 9/10 : CMD echo &quot;------------END------------------&quot;</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 48012e0616e7</span></span><br><span class="line">Removing intermediate container 48012e0616e7</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 94e78f72f3dd</span></span><br><span class="line">Step 10/10 : CMD /bin/bash</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 8209027a92c1</span></span><br><span class="line">Removing intermediate container 8209027a92c1</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 75a2f678f289</span></span><br><span class="line">Successfully built 75a2f678f289</span><br><span class="line">Successfully tagged mycentos:0.1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. 测试运行镜像：</span></span><br><span class="line">[root@test1 dockerfile]# docker images</span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">mycentos              0.1       75a2f678f289   19 seconds ago   291MB</span><br><span class="line">yyf/centos            1.0       940136b6990a   11 hours ago     209MB</span><br><span class="line">mysql                 5.7       450379344707   3 days ago       449MB</span><br><span class="line">tomcat                1.0       24fc4b5f8938   4 days ago       654MB</span><br><span class="line">tomcat                latest    c82f1a6ba61f   4 days ago       654MB</span><br><span class="line">redis                 latest    621ceef7494a   3 months ago     104MB</span><br><span class="line">tomcat                9.0       040bdb29ab37   3 months ago     649MB</span><br><span class="line">nginx                 latest    f6d0b4767a6c   3 months ago     133MB</span><br><span class="line">centos                latest    300e315adb2f   4 months ago     209MB</span><br><span class="line">portainer/portainer   latest    62771b0b9b09   8 months ago     79.1MB</span><br><span class="line">elasticsearch         latest    5acf0e8da90b   2 years ago      486MB</span><br><span class="line">[root@test1 dockerfile]# docker run -it mycentos:0.1</span><br><span class="line">[root@d83b3c66e31a local]# pwd</span><br><span class="line">/usr/local</span><br><span class="line">[root@d83b3c66e31a local]# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.17.0.3  netmask 255.255.0.0  broadcast 172.17.255.255</span><br><span class="line">        ether 02:42:ac:11:00:03  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 8  bytes 656 (656.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">[root@d83b3c66e31a local]# vim test</span><br><span class="line">[root@d83b3c66e31a local]# exit</span><br><span class="line">exit</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 5. 列出镜像变更历史的命令：docker <span class="built_in">history</span> 镜像id</span></span><br><span class="line">[root@test1 dockerfile]# docker images</span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">mycentos              0.1       75a2f678f289   2 minutes ago   291MB</span><br><span class="line">yyf/centos            1.0       940136b6990a   11 hours ago    209MB</span><br><span class="line">mysql                 5.7       450379344707   3 days ago      449MB</span><br><span class="line">tomcat                1.0       24fc4b5f8938   4 days ago      654MB</span><br><span class="line">tomcat                latest    c82f1a6ba61f   4 days ago      654MB</span><br><span class="line">redis                 latest    621ceef7494a   3 months ago    104MB</span><br><span class="line">tomcat                9.0       040bdb29ab37   3 months ago    649MB</span><br><span class="line">nginx                 latest    f6d0b4767a6c   3 months ago    133MB</span><br><span class="line">centos                latest    300e315adb2f   4 months ago    209MB</span><br><span class="line">portainer/portainer   latest    62771b0b9b09   8 months ago    79.1MB</span><br><span class="line">elasticsearch         latest    5acf0e8da90b   2 years ago     486MB</span><br><span class="line">[root@test1 dockerfile]# docker history 75a2f678f289</span><br><span class="line">IMAGE          CREATED         CREATED BY                                      SI</span><br><span class="line">75a2f678f289   2 minutes ago   /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;/bin…   0B</span><br><span class="line">94e78f72f3dd   2 minutes ago   /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;echo…   0B</span><br><span class="line">dcfb832ea5e4   2 minutes ago   /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;echo…   0B</span><br><span class="line">8ce51dd41328   2 minutes ago   /bin/sh -c #(nop)  EXPOSE 80                    0B</span><br><span class="line">3cd01c2f1f7f   2 minutes ago   /bin/sh -c yum -y install net-tools             23</span><br><span class="line">55aec80889eb   3 minutes ago   /bin/sh -c yum -y install vim                   58</span><br><span class="line">5824b7855a72   4 minutes ago   /bin/sh -c #(nop) WORKDIR /usr/local            0B</span><br><span class="line">61afbed96e00   4 minutes ago   /bin/sh -c #(nop)  ENV MYPAHT=/usr/local        0B</span><br><span class="line">46b753499dca   4 minutes ago   /bin/sh -c #(nop)  MAINTAINER yyf&lt;1436058432…   0B</span><br><span class="line">300e315adb2f   4 months ago    /bin/sh -c #(nop)  CMD [&quot;/bin/bash&quot;]            0B</span><br><span class="line">&lt;missing&gt;      4 months ago    /bin/sh -c #(nop)  LABEL org.label-schema.sc…   0B</span><br><span class="line">&lt;missing&gt;      4 months ago    /bin/sh -c #(nop) ADD file:bd7a2aed6ede423b7…   2B</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>说明：CMD 和 ENTRYPOINT 的区别</strong></p>
<ul>
<li>CMD：指定容器启动时要运行的命令，只会最后一个命令生效，可被替代</li>
<li>ENTRYPOINT：指定这个容器启动的时候要运行的命令，可以追加命令。</li>
</ul>
<p>测试 CMD：<br>dockerfile 内容：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">CMD [&quot;ls&quot;,&quot;-a&quot;]    # 增加一个命令 ls -a</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 dockerfile]# vim dockerfile-cmd-test</span><br><span class="line">[root@test1 dockerfile]# docker build -f dockerfile-cmd-test -t cmdtest .</span><br><span class="line">Sending build context to Docker daemon  3.072kB</span><br><span class="line">Step 1/2 : FROM centos</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 300e315adb2f</span></span><br><span class="line">Step 2/2 : CMD [&quot;ls&quot;, &quot;-a&quot;]</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 55ba9d120374</span></span><br><span class="line">Removing intermediate container 55ba9d120374</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 437ac1c329dd</span></span><br><span class="line">Successfully built 437ac1c329dd</span><br><span class="line">Successfully tagged cmdtest:latest</span><br><span class="line">[root@test1 dockerfile]# docker run 437ac1c329dd</span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">lost+found</span><br><span class="line">media</span><br><span class="line">mnt</span><br><span class="line">opt</span><br><span class="line">proc</span><br><span class="line">root</span><br><span class="line">run</span><br><span class="line">sbin</span><br><span class="line">srv</span><br><span class="line">sys</span><br><span class="line">tmp</span><br><span class="line">usr</span><br><span class="line">var</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 追加命令时出错，相当于执行：-l</span></span><br><span class="line">[root@test1 dockerfile]# docker run 437ac1c329dd -l</span><br><span class="line">docker: Error response from daemon: OCI runtime create failed: container_linux.go:367: starting container process caused: exec: &quot;-l&quot;: executable file not found in $PATH: unknown.</span><br></pre></td></tr></table></figure>


<p>测试 ENTRYPOINT：<br>dockerfile 内容：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">ENTRYPOINT [&quot;ls&quot;,&quot;-a&quot;]</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 dockerfile]# vim dockerfile-entrypoint-test</span><br><span class="line">[root@test1 dockerfile]# docker build -f dockerfile-entrypoint-test -t entrypointtest .</span><br><span class="line">Sending build context to Docker daemon  4.096kB</span><br><span class="line">Step 1/2 : FROM centos</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 300e315adb2f</span></span><br><span class="line">Step 2/2 : ENTRYPOINT [&quot;ls&quot;, &quot;-a&quot;]</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 1a6e5209804a</span></span><br><span class="line">Removing intermediate container 1a6e5209804a</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> c2f18e84a709</span></span><br><span class="line">Successfully built c2f18e84a709</span><br><span class="line">Successfully tagged entrypointtest:latest</span><br><span class="line">[root@test1 dockerfile]# docker run c2f18e84a709</span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">lost+found</span><br><span class="line">media</span><br><span class="line">mnt</span><br><span class="line">opt</span><br><span class="line">proc</span><br><span class="line">root</span><br><span class="line">run</span><br><span class="line">sbin</span><br><span class="line">srv</span><br><span class="line">sys</span><br><span class="line">tmp</span><br><span class="line">usr</span><br><span class="line">var</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 追加命令不会出问题，相当于执行：ls -al</span></span><br><span class="line">[root@test1 dockerfile]# docker run c2f18e84a709 -l</span><br><span class="line">total 60</span><br><span class="line">drwxr-xr-x.   1 root root 4096 Apr 13 13:26 .</span><br><span class="line">drwxr-xr-x.   1 root root 4096 Apr 13 13:26 ..</span><br><span class="line">-rwxr-xr-x.   1 root root    0 Apr 13 13:26 .dockerenv</span><br><span class="line">lrwxrwxrwx.   1 root root    7 Nov  3 15:22 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x.   5 root root  340 Apr 13 13:26 dev</span><br><span class="line">drwxr-xr-x.   1 root root 4096 Apr 13 13:26 etc</span><br><span class="line">drwxr-xr-x.   2 root root 4096 Nov  3 15:22 home</span><br><span class="line">lrwxrwxrwx.   1 root root    7 Nov  3 15:22 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx.   1 root root    9 Nov  3 15:22 lib64 -&gt; usr/lib64</span><br><span class="line">drwx------.   2 root root 4096 Dec  4 17:37 lost+found</span><br><span class="line">drwxr-xr-x.   2 root root 4096 Nov  3 15:22 media</span><br><span class="line">drwxr-xr-x.   2 root root 4096 Nov  3 15:22 mnt</span><br><span class="line">drwxr-xr-x.   2 root root 4096 Nov  3 15:22 opt</span><br><span class="line">dr-xr-xr-x. 114 root root    0 Apr 13 13:26 proc</span><br><span class="line">dr-xr-x---.   2 root root 4096 Dec  4 17:37 root</span><br><span class="line">drwxr-xr-x.  11 root root 4096 Dec  4 17:37 run</span><br><span class="line">lrwxrwxrwx.   1 root root    8 Nov  3 15:22 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x.   2 root root 4096 Nov  3 15:22 srv</span><br><span class="line">dr-xr-xr-x.  13 root root    0 Apr 13 00:36 sys</span><br><span class="line">drwxrwxrwt.   7 root root 4096 Dec  4 17:37 tmp</span><br><span class="line">drwxr-xr-x.  12 root root 4096 Dec  4 17:37 usr</span><br><span class="line">drwxr-xr-x.  20 root root 4096 Dec  4 17:37 var</span><br></pre></td></tr></table></figure>

<h3 id="5-7-实战：使用-DockerFile-制作-Tomcat-镜像"><a href="#5-7-实战：使用-DockerFile-制作-Tomcat-镜像" class="headerlink" title="5.7 实战：使用 DockerFile 制作 Tomcat 镜像"></a>5.7 实战：使用 DockerFile 制作 Tomcat 镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 需要准备 Tomcat 压缩包，JDK 压缩包，建立一个 tomcat 目录，使用 rz 命令从 Windows 上传到 Linux 中</span></span><br><span class="line">[root@test1 home]# ls</span><br><span class="line">ceshi  dockerfile  docker-test-volume  lost+found  mysql  nginx03  test.java  tomcat</span><br><span class="line">[root@test1 home]# rz</span><br><span class="line"></span><br><span class="line">[root@test1 home]# ls</span><br><span class="line">apache-tomcat-7.0.47.tar.gz  ceshi  dockerfile  docker-test-volume  jdk-8u11-linux-x64.tar.gz  lost+found  mysql  nginx03  test.java  tomcat</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 编写 Dockerfile 文件，文件名使用 【Dockerfile】，build 会自动寻找这个文件，就不用 -f 指定该文件的位置了</span></span><br><span class="line">[root@test1 tomcat]# vi Dockerfile</span><br><span class="line">[root@test1 tomcat]# cat Dockerfile</span><br><span class="line">FROM centos</span><br><span class="line"></span><br><span class="line">MAINTAINER yyf&lt;1436058432@qq.com&gt;</span><br><span class="line"></span><br><span class="line">COPY readme.txt /usr/local/readme.txt  # 将主机的 readme.txt 文件拷贝到容器的目录中</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加压缩包到容器内，压缩包会自动解压到容器的指定目录中</span></span><br><span class="line">ADD jdk-8u11-linux-x64.tar.gz /usr/local/</span><br><span class="line">ADD apache-tomcat-7.0.47.tar.gz /usr/local/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 建立容器时安装一些工具</span></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置工作目录</span></span><br><span class="line">ENV MYPATH /usr/local/</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置 JDK 环境变量</span></span><br><span class="line">ENV JAVA_HOME /usr/local/jdk1.8.0_11</span><br><span class="line">ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置 tomcat 环境变量</span></span><br><span class="line">ENV CATALINA_HOME /usr/local/apache-tomcat-7.0.47</span><br><span class="line">ENV CATALINA_BASE /usr/local/apache-tomcat-7.0.47</span><br><span class="line">ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 暴露端口</span></span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动时到指定目录执行 tomcat，并且输出日志</span></span><br><span class="line">CMD /usr/local/apache-tomcat-7.0.47/bin/startup.sh &amp;&amp; tail -F /usr/local/apache-tomcat-7.0.47/bin/logs/catalina.out </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 构建镜像</span></span><br><span class="line">[root@test1 tomcat]# docker build -t diytomcat .</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. 启动镜像</span></span><br><span class="line">[root@test1 tomcat]# docker images</span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">diytomcat             latest    bb7c3756992d   12 minutes ago   628MB</span><br><span class="line">entrypointtest        latest    c2f18e84a709   13 hours ago     209MB</span><br><span class="line">[root@test1 tomcat]# docker run -d -p 9090:8080 --name diytomcat01 -v /home/tomcat/test:/usr/local/apache-tomcat-7.0.47/webapps/test -v /home/tomcat/tomcatlogs/:/usr/local/apache-tomcat-7.0.47/logs diytomcat</span><br><span class="line">915503c4effa5c1776f79e29fb386b0431a0f7c6b5b4432bdebdea7025c8dbd1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看一下目录中的文件，已经显示出 <span class="built_in">test</span>、tomcatlogs</span></span><br><span class="line">[root@test1 tomcat]# ls</span><br><span class="line">apache-tomcat-7.0.47.tar.gz  Dockerfile  jdk-8u11-linux-x64.tar.gz  readme.txt  test  tomcatlogs</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 5. 访问测试</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入容器查看目录</span></span><br><span class="line">[root@test1 tomcat]# docker exec -it 915503c4effa5c1 /bin/bash</span><br><span class="line">[root@915503c4effa local]# pwd</span><br><span class="line">/usr/local</span><br><span class="line">[root@915503c4effa local]# ls -l</span><br><span class="line">total 56</span><br><span class="line">drwxr-xr-x. 1 root root 4096 Apr 14 02:00 apache-tomcat-7.0.47</span><br><span class="line">drwxr-xr-x. 2 root root 4096 Nov  3 15:22 bin</span><br><span class="line">drwxr-xr-x. 2 root root 4096 Nov  3 15:22 etc</span><br><span class="line">drwxr-xr-x. 2 root root 4096 Nov  3 15:22 games</span><br><span class="line">drwxr-xr-x. 2 root root 4096 Nov  3 15:22 include</span><br><span class="line">drwxr-xr-x. 8   10  143 4096 Jun 17  2014 jdk1.8.0_11</span><br><span class="line">drwxr-xr-x. 2 root root 4096 Nov  3 15:22 lib</span><br><span class="line">drwxr-xr-x. 3 root root 4096 Dec  4 17:37 lib64</span><br><span class="line">drwxr-xr-x. 2 root root 4096 Nov  3 15:22 libexec</span><br><span class="line">-rw-r--r--. 1 root root    0 Apr 14 01:41 readme.txt</span><br><span class="line">drwxr-xr-x. 2 root root 4096 Nov  3 15:22 sbin</span><br><span class="line">drwxr-xr-x. 5 root root 4096 Dec  4 17:37 share</span><br><span class="line">drwxr-xr-x. 2 root root 4096 Nov  3 15:22 src</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 另外一个窗口在主机端执行命令</span></span><br><span class="line">[root@test1 tomcat]# curl localhost:9090</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;Apache Tomcat/7.0.47&lt;/title&gt;</span><br><span class="line">        &lt;link href=&quot;favicon.ico&quot; rel=&quot;icon&quot; type=&quot;image/x-icon&quot; /&gt;</span><br><span class="line">        &lt;link href=&quot;favicon.ico&quot; rel=&quot;shortcut icon&quot; type=&quot;image/x-icon&quot; /&gt;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 浏览器中可通过 IP:9090 访问网页</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 6. 发布项目（启动容器时，作了卷挂载，直接在本地就可以写项目）</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在 WEB-INF 目录中新建 web.xml 文件，并建立 index.jsp 文件</span></span><br><span class="line"></span><br><span class="line">[root@test1 test]# mkdir WEN-INF/</span><br><span class="line">[root@test1 test]# cd ./WEN-INF</span><br><span class="line">[root@test1 WEN-INF]# vim web.xml</span><br><span class="line">[root@test1 WEN-INF]# cd ..</span><br><span class="line">[root@test1 test]# vim index.jsp</span><br><span class="line">[root@test1 test]# ls</span><br><span class="line">index.jsp  WEN-INF</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> web.xml 文件内容</span></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;web-app xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot; xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee </span><br><span class="line">                             http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot; </span><br><span class="line">         version=&quot;2.5&quot;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/web-app&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> index.jsp 文件内容</span></span><br><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</span><br><span class="line">    pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Test&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">        Hello World!</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 可通过浏览器访问 IP:9090/<span class="built_in">test</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 可以查看日志文件</span></span><br><span class="line">[root@test1 tomcat]# ls</span><br><span class="line">apache-tomcat-7.0.47.tar.gz  Dockerfile  jdk-8u11-linux-x64.tar.gz  readme.txt  test  tomcatlogs</span><br><span class="line">[root@test1 tomcat]# cd ./tomcatlogs</span><br><span class="line">[root@test1 tomcatlogs]# ls</span><br><span class="line">catalina.2021-04-14.log  catalina.out  host-manager.2021-04-14.log  localhost.2021-04-14.log  localhost_access_log.2021-04-14.txt  manager.2021-04-14.log</span><br><span class="line">[root@test1 tomcatlogs]# cat catalina.out</span><br><span class="line">Apr 14, 2021 2:22:17 AM org.apache.catalina.core.AprLifecycleListener init</span><br><span class="line">INFO: The APR based Apache Tomcat Native library which allows optimal performance in production environments was not found on the java.library.path: /usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib</span><br><span class="line">Apr 14, 2021 2:22:18 AM org.apache.coyote.AbstractProtocol init</span><br><span class="line">INFO: Initializing ProtocolHandler [&quot;http-bio-8080&quot;]</span><br><span class="line">Apr 14, 2021 2:22:18 AM org.apache.coyote.AbstractProtocol</span><br></pre></td></tr></table></figure>

<p><strong>将镜像发布到 DockerHub 上：</strong><br>登录 dockerhub 的命令:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 tomcat]# docker login --help</span><br><span class="line"></span><br><span class="line">Usage:  docker login [OPTIONS] [SERVER]</span><br><span class="line"></span><br><span class="line">Log in to a Docker registry.</span><br><span class="line">If no server is specified, the default is defined by the daemon.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -p, --password string   Password</span><br><span class="line">      --password-stdin    Take the password from stdin</span><br><span class="line">  -u, --username string   Username</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 登录 dockerhub</span></span><br><span class="line">[root@test1 tomcat]# docker login -u crystal1213</span><br><span class="line">Password: </span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 给即将发布的镜像设定一个标签：docker tag 镜像id 镜像名:版本号</span></span><br><span class="line">[root@test1 tomcat]# docker images</span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED             SIZE</span><br><span class="line">diytomcat             latest    bb7c3756992d   About an hour ago   628MB</span><br><span class="line">entrypointtest        latest    c2f18e84a709   14 hours ago        209MB</span><br><span class="line">cmdtest               latest    437ac1c329dd   14 hours ago        209MB</span><br><span class="line">[root@test1 tomcat]# docker tag bb7c3756992d yyf/diytomcat:1.0</span><br><span class="line">[root@test1 tomcat]# docker images</span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED             SIZE</span><br><span class="line">diytomcat             latest    bb7c3756992d   About an hour ago   628MB</span><br><span class="line">yyf/diytomcat         1.0       bb7c3756992d   About an hour ago   628MB</span><br><span class="line">entrypointtest        latest    c2f18e84a709   14 hours ago        209MB</span><br><span class="line">cmdtest               latest    437ac1c329dd   14 hours ago        209MB</span><br><span class="line">mycentos              0.1       75a2f678f289   14 hours ago        291MB</span><br><span class="line">yyf/centos            1.0       940136b6990a   25 hours ago        209MB</span><br><span class="line">mysql                 5.7       450379344707   3 days ago          449MB</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 提交到 dockerhub</span></span><br><span class="line">[root@test1 tomcat]# docker push yyf/diytomcat:1.0</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>说明：自己发布的镜像尽量带版本号，如果是本地虚拟机，由于 Dockerhub 是国外的，需要翻墙所以被拒绝。发布的时候也是按照镜像的层级来提交的。</p>
<p><strong>将镜像发布到阿里云上：</strong></p>
<ol>
<li><p>登录阿里云</p>
</li>
<li><p>找到容器镜像服务，在实例列表中创建个人版实例<br><img src="https://i.loli.net/2021/04/14/UWoze869MB1ROLG.png" alt="image.png"></p>
</li>
<li><p>创建命名空间<br><img src="https://i.loli.net/2021/04/14/LGwJrtQsb3WI8O7.png" alt="image.png"></p>
</li>
<li><p>创建镜像仓库<br> <img src="https://i.loli.net/2021/04/14/vdeOKJUwWBNr6Rz.png" alt="image.png"></p>
</li>
<li><p>点击仓库名可看到相应的命令<br><img src="https://i.loli.net/2021/04/14/sKlP8hadZACyQO7.png" alt="image.png"></p>
</li>
</ol>
<p>执行登录命令后就可以将镜像 push 到阿里云，更详细的命令可参考官方文档</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 ~]# sudo docker tag bb7c3756992d registry.cn-hangzhou.aliyuncs.com/yyf-docker-study/ityyf-docker-study:1.2</span><br><span class="line">[root@test1 ~]# docker images</span><br><span class="line">REPOSITORY                                                              TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">diytomcat                                                               latest    bb7c3756992d   5 hours ago    628MB</span><br><span class="line">yyf/diytomcat                                                           1.0       bb7c3756992d   5 hours ago    628MB</span><br><span class="line">registry.cn-hangzhou.aliyuncs.com/yyf-docker-study/ityyf-docker-study   1.2       bb7c3756992d   5 hours ago    628MB</span><br><span class="line">entrypointtest                                                          latest    c2f18e84a709   17 hours ago   209MB</span><br><span class="line">[root@test1 ~]# sudo docker push registry.cn-hangzhou.aliyuncs.com/yyf-docker-study/ityyf-docker-study:1.2</span><br><span class="line">The push refers to repository [registry.cn-hangzhou.aliyuncs.com/yyf-docker-study/ityyf-docker-study]</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>最后，点击仓库名，点击镜像版本，会显示层信息<br><img src="https://i.loli.net/2021/04/14/Dflmr9FBXhjEdGw.png" alt="image.png"></p>
<h3 id="5-8-Docker-所有流程小结"><a href="#5-8-Docker-所有流程小结" class="headerlink" title="5.8 Docker 所有流程小结"></a>5.8 Docker 所有流程小结</h3><p><img src="https://img-blog.csdnimg.cn/20201009012255816.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center"></p>
<p><img src="https://img-blog.csdnimg.cn/20201009012320547.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center"></p>
<h2 id="6-Docker-网络学习"><a href="#6-Docker-网络学习" class="headerlink" title="6 Docker 网络学习"></a>6 Docker 网络学习</h2><h3 id="6-1-理解-Docker0"><a href="#6-1-理解-Docker0" class="headerlink" title="6.1 理解 Docker0"></a>6.1 理解 Docker0</h3><p>首先，清空所有的容器和镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 移除所有的容器</span></span><br><span class="line">docker rm -f $(docker ps -aq)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 移除所有的镜像</span></span><br><span class="line">docker rmi -f $(docker images -aq)</span><br></pre></td></tr></table></figure>
<p>查看网络地址的命令：</p>
<ul>
<li><code>ip addr</code></li>
<li><code>ip a</code></li>
<li><code>ifconfig</code></li>
</ul>
<p>下图中展示了我们的 ip 地址有 3 个网络，三个网络代表三个不同的环境<br><img src="https://i.loli.net/2021/04/14/ZUF6il1LR9C7sVB.png" alt="image.png"></p>
<p><strong>Q:</strong> docker 是如何处理容器网络访问的呢？例如我们在 tomcat 中运行着一个 web 项目，同时 web 项目需要连接一个 mysql 数据库，那么 tomcat 和数据库之间该怎么连接呢？<br><img src="https://img-blog.csdnimg.cn/2020100901260162.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center"></p>
<blockquote>
<p>测试1：主机是否可以 ping 通容器</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 启动一个 tomcat</span></span><br><span class="line">[root@test1 ~]# docker run -d -P --name tomcat01 tomcat</span><br><span class="line">Unable to find image &#x27;tomcat:latest&#x27; locally</span><br><span class="line">latest: Pulling from library/tomcat</span><br><span class="line">bd8f6a7501cc: Pull complete </span><br><span class="line">44718e6d535d: Pull complete </span><br><span class="line">efe9738af0cb: Pull complete </span><br><span class="line">f37aabde37b8: Pull complete </span><br><span class="line">b87fc504233c: Pull complete </span><br><span class="line">8bf93eef8c9e: Pull complete </span><br><span class="line">a62c27841e77: Pull complete </span><br><span class="line">3b23560b24c9: Pull complete </span><br><span class="line">168537fce8fb: Pull complete </span><br><span class="line">6643b79f9364: Pull complete </span><br><span class="line">Digest: sha256:a655be865e9f62d6d2ed3823c7382a2d77d0a034eb17714bbf2a514c3f620717</span><br><span class="line">Status: Downloaded newer image for tomcat:latest</span><br><span class="line">86df8604d4f03e682e2e882e35a6a0fe79d564890964b534357c1ba119effaa1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 进入容器，查看 tomcat 网络地址，可以看到 14: eth0@if15 的 ip 地址</span></span><br><span class="line">[root@test1 ~]# docker exec -it tomcat01 ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">14: eth0@if15: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 在容器外部 ping tomcat01 容器，是完全可以 ping 通的</span></span><br><span class="line">[root@test1 ~]# ping 172.17.0.2</span><br><span class="line">PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.582 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.122 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=3 ttl=64 time=0.122 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=4 ttl=64 time=0.122 ms</span><br><span class="line">^C</span><br><span class="line">--- 172.17.0.2 ping statistics ---</span><br><span class="line">4 packets transmitted, 4 received, 0% packet loss, time 3000ms</span><br><span class="line">rtt min/avg/max/mdev = 0.122/0.237/0.582/0.199 ms</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. 在容器外测试 ip a</span></span><br><span class="line">[root@test1 ~]# ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:0c:29:dd:a1:5e brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.137.4/24 brd 192.168.137.255 scope global noprefixroute ens33</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::e6b5:7e56:855a:f17e/64 scope link noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:cd:ea:a0:d7 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:cdff:feea:a0d7/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">15: veth031a39b@if14: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default </span><br><span class="line">    link/ether 0e:91:8f:15:0d:a8 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet6 fe80::c91:8fff:fe15:da8/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>结论：</strong> 主机可以 ping 通容器<br><strong>原理：</strong> 我们每启动一个 docker 容器，docker 就会给容器分配一个 ip 地址，我们只要安装了 docker 就会有一个 docker0 的网卡，使用的是桥接模式【bridge】，使用的技术就是【veth-pair】技术。</p>
<blockquote>
<p>测试2：测试两个容器之间能否通信</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 紧接着上面的实验，再启动一个 tomcat</span></span><br><span class="line">[root@test1 ~]# docker run -d -P --name tomcat02 tomcat</span><br><span class="line">47d60c4d77378ec5eb5ea1e750601d5d74e7875dd74ca1a225f8b020d32ad628</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 查看 ip 地址，可以看到多了一组</span></span><br><span class="line">[root@test1 ~]# ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:0c:29:dd:a1:5e brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.137.4/24 brd 192.168.137.255 scope global noprefixroute ens33</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::e6b5:7e56:855a:f17e/64 scope link noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:cd:ea:a0:d7 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:cdff:feea:a0d7/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">15: veth031a39b@if14: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default </span><br><span class="line">    link/ether 0e:91:8f:15:0d:a8 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet6 fe80::c91:8fff:fe15:da8/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">17: veth2c0ce1b@if16: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default </span><br><span class="line">    link/ether e2:68:f5:00:c1:c9 brd ff:ff:ff:ff:ff:ff link-netnsid 1</span><br><span class="line">    inet6 fe80::e068:f5ff:fe00:c1c9/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 进入容器 tomcat02，查看 该容器的 ip 地址</span></span><br><span class="line">[root@test1 ~]# docker exec -it tomcat02 ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">16: eth0@if17: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.3/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. 容器 tomcat02 ping 容器 tomcat01</span></span><br><span class="line">[root@test1 ~]# docker exec -it tomcat02 ping 172.17.0.2</span><br><span class="line">PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.528 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.165 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=3 ttl=64 time=0.165 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=4 ttl=64 time=0.164 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=5 ttl=64 time=0.164 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=6 ttl=64 time=0.164 ms</span><br><span class="line">^C</span><br><span class="line">--- 172.17.0.2 ping statistics ---</span><br><span class="line">6 packets transmitted, 6 received, 0% packet loss, time 6ms</span><br><span class="line">rtt min/avg/max/mdev = 0.164/0.225/0.528/0.135 ms</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>说明：再启动一个容器测试时，多了一对网卡【上述实验中的 17: veth2c0ce1b@if16:】，启动容器带来的额网卡都是一对一对的，这就是 <code>veth-pair</code>，它就是一对虚拟设备接口，它们都是成对出现的，一端连着协议栈，一端相连。正式因为有这个特性，veth-pair 才能充当一个桥梁，连接着各种虚拟网络设备。OpenStac、Docker 容器之间的连接、OVS 的连接，都是使用 veth-pair。</p>
<p><strong>结论：</strong>容器和容器之间是可以 ping 通的。</p>
<p>测试2的网络模型图：<br><img src="https://i.loli.net/2021/04/14/opzO2QDMlZSrnJK.png" alt="image.png"><br>说明：tomcat01 和 tomcat02 是共用一个路由器 docker0，所有容器在不指定网络的情况下，都是 docker0 路由的，docker 会给我们的路由器分配一个默认的可用 ip 地址</p>
<p><strong>小结：</strong><br>Docker 使用的是 Linux 的桥接模式，宿主机中是一个 Docker 容器的网桥 docker0，所有东西都是经过这个 docker0 的，只要你启动一个容器，不指定一个网络它就会往 docker0 这里给你分配一个 ip，最多能分配【256*256=65535】。如果是容器之间需要通信，那么久通过 veth-pair 给转发过去，如下图所示，核心就是利用了 Linux 虚拟化网络技术，在容器内核 docker0 分别创建了一个虚拟网卡，通过 veth-pair 进行连接。<br><img src="https://img-blog.csdnimg.cn/20201009013411839.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center"></p>
<p><strong>Docker 中所有的网络接口都是虚拟的，这是因为虚拟的转发效率高，只要在一个容器内转发是非常快的。</strong></p>
<p>可以通过 docker network 命令查看到所有容器的信息：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看 docker network 命令的使用方法：</span></span><br><span class="line">[root@test1 ~]# docker network --help</span><br><span class="line"></span><br><span class="line">Usage:  docker network COMMAND</span><br><span class="line"></span><br><span class="line">Manage networks</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  connect     Connect a container to a network</span><br><span class="line">  create      Create a network</span><br><span class="line">  disconnect  Disconnect a container from a network</span><br><span class="line">  inspect     Display detailed information on one or more networks</span><br><span class="line">  ls          List networks</span><br><span class="line">  prune       Remove all unused networks</span><br><span class="line">  rm          Remove one or more networks</span><br><span class="line"></span><br><span class="line">Run &#x27;docker network COMMAND --help&#x27; for more information on a command.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 列举出所有的网络，其中名为 bridge 对应的网络 id 就是 docker0 这个网络</span></span><br><span class="line">[root@test1 ~]# docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">9c205042ce32   bridge    bridge    local</span><br><span class="line">f6ef41db727a   host      host      local</span><br><span class="line">c2c5f04a92d1   none      null      local</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 docker0 这个网络的详细信息，在 Containers 下面可以看到所有的容器。</span></span><br><span class="line">[root@test1 ~]# docker network inspect 9c205042ce32</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;9c205042ce3279ca51c5346daddb41795a1b42dfa9985cf5dd0072e2caac58c3&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-04-15T09:18:08.83145424+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: null,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;172.17.0.0/16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.17.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;1c90cf884d3ea9b73d431199325034b1f663527ae45ce0cd0fa80fda42db9516&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat03&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;0ce8d2d8b95e7ef1521377323a2040af35b6d73f43292d1738cf64a41ed6405f&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:ac:11:00:04&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;172.17.0.4/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;47d60c4d77378ec5eb5ea1e750601d5d74e7875dd74ca1a225f8b020d32ad628&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat02&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;7fe5c4004bc01b3389a41b7db9a7784dbfe4be50ff3a40e831b1bedaf47ab637&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:ac:11:00:03&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;172.17.0.3/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;86df8604d4f03e682e2e882e35a6a0fe79d564890964b534357c1ba119effaa1&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat01&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;c0dda5cdad51f713faf1ef3252672120fb8a7fcdd7558e4272994a333e78f37b&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;172.17.0.2/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;</span><br><span class="line">            &quot;com.docker.network.bridge.default_bridge&quot;: &quot;true&quot;,</span><br><span class="line">            &quot;com.docker.network.bridge.enable_icc&quot;: &quot;true&quot;,</span><br><span class="line">            &quot;com.docker.network.bridge.enable_ip_masquerade&quot;: &quot;true&quot;,</span><br><span class="line">            &quot;com.docker.network.bridge.host_binding_ipv4&quot;: &quot;0.0.0.0&quot;,</span><br><span class="line">            &quot;com.docker.network.bridge.name&quot;: &quot;docker0&quot;,</span><br><span class="line">            &quot;com.docker.network.driver.mtu&quot;: &quot;1500&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="6-2-–link-容器互联（了解即可）"><a href="#6-2-–link-容器互联（了解即可）" class="headerlink" title="6.2 –link 容器互联（了解即可）"></a>6.2 –link 容器互联（了解即可）</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 通过容器的名字是无法 ping 通的，如下：启动两个容器，让后一个容器 ping 另外一个容器</span></span><br><span class="line">[root@test1 ~]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND             CREATED        STATUS                      PORTS     NAMES</span><br><span class="line">47d60c4d7737   tomcat    &quot;catalina.sh run&quot;   16 hours ago   Exited (143) 13 hours ago             tomcat02</span><br><span class="line">86df8604d4f0   tomcat    &quot;catalina.sh run&quot;   16 hours ago   Exited (143) 13 hours ago             tomcat01</span><br><span class="line">[root@test1 ~]# docker start tomcat01</span><br><span class="line">tomcat01</span><br><span class="line">[root@test1 ~]# docker start tomcat02</span><br><span class="line">tomcat02</span><br><span class="line">[root@test1 ~]# docker exec -it tomcat02 ping tomcat01</span><br><span class="line">ping: tomcat01: Name or service not known</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 运行容器时，使用 --link 和想要 ping 的容器进行连接，就可以 ping 通，这个连接是单向的，反过来还是不能 ping 通，具体可看配置文件中的信息</span></span><br><span class="line">[root@test1 ~]# docker run -d -P --name tomcat03 --link tomcat02 tomcat</span><br><span class="line">1c90cf884d3ea9b73d431199325034b1f663527ae45ce0cd0fa80fda42db9516</span><br><span class="line">[root@test1 ~]# docker exec -it tomcat03 ping tomcat02</span><br><span class="line">PING tomcat02 (172.17.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat02 (172.17.0.3): icmp_seq=1 ttl=64 time=0.447 ms</span><br><span class="line">64 bytes from tomcat02 (172.17.0.3): icmp_seq=2 ttl=64 time=0.166 ms</span><br><span class="line">64 bytes from tomcat02 (172.17.0.3): icmp_seq=3 ttl=64 time=0.165 ms</span><br><span class="line">64 bytes from tomcat02 (172.17.0.3): icmp_seq=4 ttl=64 time=0.166 ms</span><br><span class="line">^C</span><br><span class="line">--- tomcat02 ping statistics ---</span><br><span class="line">4 packets transmitted, 4 received, 0% packet loss, time 4ms</span><br><span class="line">rtt min/avg/max/mdev = 0.165/0.236/0.447/0.121 ms</span><br><span class="line">[root@test1 ~]# docker exec -it tomcat02 ping tomcat03</span><br><span class="line">ping: tomcat03: Name or service not known</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 原理探究---&gt;tomcat03 配置文件中的信息：可以看到 tomcat02 的信息</span></span><br><span class="line">[root@test1 ~]# docker exec -it tomcat03 cat /etc/hosts</span><br><span class="line">127.0.0.1	localhost</span><br><span class="line">::1	localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0	ip6-localnet</span><br><span class="line">ff00::0	ip6-mcastprefix</span><br><span class="line">ff02::1	ip6-allnodes</span><br><span class="line">ff02::2	ip6-allrouters</span><br><span class="line">172.17.0.3	tomcat02 47d60c4d7737</span><br><span class="line">172.17.0.4	1c90cf884d3e</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>说明：</p>
<ul>
<li><code>--link</code> 命令就是在 hosts 配置中添加了一个 tomcat02 的映射，而现在已不建议使用这个命令了，我们通常会使用自定义网络来实现容器之间的互联，并且这里也不使用 docker0，因为 docker0 不支持通过容器名连接访问。</li>
<li>/etc/hosts 文件：文件中写了配置的一些本地绑定的信息</li>
</ul>
<h3 id="6-3-自定义网络"><a href="#6-3-自定义网络" class="headerlink" title="6.3 自定义网络"></a>6.3 自定义网络</h3><p>network 相关的命令：</p>
<figure class="highlight plain"><figcaption><span>~]# docker network --help</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Usage:  docker network COMMAND</span><br><span class="line"></span><br><span class="line">Manage networks</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  connect     Connect a container to a network</span><br><span class="line">  create      Create a network</span><br><span class="line">  disconnect  Disconnect a container from a network</span><br><span class="line">  inspect     Display detailed information on one or more networks</span><br><span class="line">  ls          List networks</span><br><span class="line">  prune       Remove all unused networks</span><br><span class="line">  rm          Remove one or more networks</span><br><span class="line"></span><br><span class="line">Run &#39;docker network COMMAND --help&#39; for more information on a command.</span><br></pre></td></tr></table></figure>

<p>查看一下所有的 docker 网络：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@test1 ~]# docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">9c205042ce32   bridge    bridge    local</span><br><span class="line">f6ef41db727a   host      host      local</span><br><span class="line">c2c5f04a92d1   none      null      local</span><br></pre></td></tr></table></figure>
<ul>
<li><code>bridge</code>：桥接 docker（默认，自己创建也使用 bridge 模式）</li>
<li><code>host</code>：和宿主机共享网络</li>
<li><code>none</code>：不配置网络</li>
</ul>
<blockquote>
<p>测试：如何自定义网络？自定义网络的好处</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 移除所有的镜像，移除所有的容器，查看下网卡的状态</span></span><br><span class="line">docker rm -f $(docker ps -aq)</span><br><span class="line">docker rmi -f $(docker images -aq)</span><br><span class="line"></span><br><span class="line">[root@test1 ~]# ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:0c:29:dd:a1:5e brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.137.4/24 brd 192.168.137.255 scope global noprefixroute ens33</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::e6b5:7e56:855a:f17e/64 scope link noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default </span><br><span class="line">    link/ether 02:42:7b:bd:c4:b6 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:7bff:febd:c4b6/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 说明：之前启动容器默认就是 --net bridge。默认的网络模式的缺点就是：不能通过容器名 ping 通，但可以通过 --link 打通，不建议使用，但可以自定义网络来实现</span></span><br><span class="line">docker run -d -P --name tomcat01 tomcat</span><br><span class="line"><span class="meta">#</span><span class="bash"> 相当于如下命令：</span></span><br><span class="line">docker run -d -P --name tomcat01 --net bridge tomcat</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 自定义网络</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --driver bridge 桥接模式</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --subnet 192.168.0.0/16 配置子网</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --gateway 192.168.0.1 配置默认的路由网关</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mynet 自定义的网络名</span></span><br><span class="line">[root@test1 ~]# docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet</span><br><span class="line">fb8e5416dc8cbce63f5c589deea58a25ac611492ae706f36c8da689302f7409e</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看一下：</span></span><br><span class="line">[root@test1 ~]# docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">9c205042ce32   bridge    bridge    local</span><br><span class="line">f6ef41db727a   host      host      local</span><br><span class="line">fb8e5416dc8c   mynet     bridge    local</span><br><span class="line">c2c5f04a92d1   none      null      local</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 mynet 的详细信息：</span></span><br><span class="line">[root@test1 ~]# docker network inspect mynet</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;mynet&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;fb8e5416dc8cbce63f5c589deea58a25ac611492ae706f36c8da689302f7409e&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-04-15T10:26:14.371183053+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;192.168.0.0/16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;192.168.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 启动两个容器，让两个容器均在 mynet 网络下</span></span><br><span class="line">[root@test1 ~]# docker run -d -P --name tomcat-net-01 --net mynet tomcat</span><br><span class="line">9cf9e997d05e4061155e3d2f3424bc96bc87de730bd231afcaf3f2f735c11907</span><br><span class="line">[root@test1 ~]# docker run -d -P --name tomcat-net-02 --net mynet tomcat</span><br><span class="line">f51ac660ce268c0086487756c701629b3bffb0c9ddaab9d0f9713f0194a3e166</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 mynet 网络的具体信息：可以看到两个容器的信息</span></span><br><span class="line">[root@test1 ~]# docker network inspect mynet</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;mynet&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;fb8e5416dc8cbce63f5c589deea58a25ac611492ae706f36c8da689302f7409e&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-04-15T10:26:14.371183053+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;192.168.0.0/16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;192.168.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;9cf9e997d05e4061155e3d2f3424bc96bc87de730bd231afcaf3f2f735c11907&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat-net-01&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;14aced5ade4f5e4dcc9b86b129eb42faf6bb7eaf9c48c6e1750b845942204252&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.2/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;f51ac660ce268c0086487756c701629b3bffb0c9ddaab9d0f9713f0194a3e166&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat-net-02&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;4f17b1b0a390df69b6bbec29cdef9a0a3eb5d132ff5b602caf9de290806b2c87&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:03&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.3/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. 使用容器名两个容器相互 ping，测试发现均可以 ping 通</span> </span><br><span class="line">[root@test1 ~]# docker exec -it tomcat-net-01 ping tomcat-net-02</span><br><span class="line">PING tomcat-net-02 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=1 ttl=64 time=0.520 ms</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=2 ttl=64 time=0.159 ms</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=3 ttl=64 time=0.158 ms</span><br><span class="line">^C</span><br><span class="line">--- tomcat-net-02 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 5ms</span><br><span class="line">rtt min/avg/max/mdev = 0.158/0.279/0.520/0.170 ms</span><br><span class="line">[root@test1 ~]# docker exec -it tomcat-net-02 ping tomcat-net-01</span><br><span class="line">PING tomcat-net-01 (192.168.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=1 ttl=64 time=0.059 ms</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=2 ttl=64 time=0.166 ms</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=3 ttl=64 time=0.162 ms</span><br><span class="line">^C</span><br><span class="line">--- tomcat-net-01 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 5ms</span><br><span class="line">rtt min/avg/max/mdev = 0.059/0.129/0.166/0.049 ms</span><br></pre></td></tr></table></figure>

<p><strong>结论：</strong> 使用自定义的网络，不使用 –link 也能 ping 通容器名字！<br><strong>自定义网络的好处：</strong></p>
<ul>
<li>redis：不同的集群使用不同的网络，保证集群式安全健康的；</li>
<li>mysql：不同的集群使用不同的网络，保证集群式安全健康的。</li>
</ul>
<h3 id="6-4-网络连通"><a href="#6-4-网络连通" class="headerlink" title="6.4 网络连通"></a>6.4 网络连通</h3><p><strong>核心命令：</strong> 【docker network connect –help】</p>
<blockquote>
<p>测试：下图中的两个不同网络的容器，不在同一网段的容器能否 ping 通，tomcat-net-01 能否 ping 通 tomcat01？</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20201009022427614.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 使用 docker0 路由【bridge】启动两个容器</span></span><br><span class="line">[root@test1 ~]# docker run -d -P --name tomcat01 tomcat</span><br><span class="line">54bd4576e8336226977028273ce4daaa27dd2ccceabe33ed1b47e39202f50415</span><br><span class="line">[root@test1 ~]# docker run -d -P --name tomcat02 tomcat</span><br><span class="line">3f4248a5b4c3f7090c92c5a96787587e6bac4f9546a5e948668a1a2f93afba2b</span><br><span class="line">[root@test1 ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND             CREATED          STATUS          PORTS                     NAMES</span><br><span class="line">3f4248a5b4c3   tomcat    &quot;catalina.sh run&quot;   4 seconds ago    Up 3 seconds    0.0.0.0:49160-&gt;8080/tcp   tomcat02</span><br><span class="line">54bd4576e833   tomcat    &quot;catalina.sh run&quot;   24 seconds ago   Up 22 seconds   0.0.0.0:49159-&gt;8080/tcp   tomcat01</span><br><span class="line">f51ac660ce26   tomcat    &quot;catalina.sh run&quot;   40 minutes ago   Up 40 minutes   0.0.0.0:49158-&gt;8080/tcp   tomcat-net-02</span><br><span class="line">9cf9e997d05e   tomcat    &quot;catalina.sh run&quot;   40 minutes ago   Up 40 minutes   0.0.0.0:49157-&gt;8080/tcp   tomcat-net-01</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 将 tomcat01 容器和 mynet 网络进行连接，使用 docker network connect 命令</span></span><br><span class="line">[root@test1 ~]# docker network --help</span><br><span class="line"></span><br><span class="line">Usage:  docker network COMMAND</span><br><span class="line"></span><br><span class="line">Manage networks</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  connect     Connect a container to a network</span><br><span class="line">  create      Create a network</span><br><span class="line">  disconnect  Disconnect a container from a network</span><br><span class="line">  inspect     Display detailed information on one or more networks</span><br><span class="line">  ls          List networks</span><br><span class="line">  prune       Remove all unused networks</span><br><span class="line">  rm          Remove one or more networks</span><br><span class="line"></span><br><span class="line">Run &#x27;docker network COMMAND --help&#x27; for more information on a command.</span><br><span class="line">[root@test1 ~]# docker network connect --help</span><br><span class="line"></span><br><span class="line">Usage:  docker network connect [OPTIONS] NETWORK CONTAINER</span><br><span class="line"></span><br><span class="line">Connect a container to a network</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --alias strings           Add network-scoped alias for the container</span><br><span class="line">      --driver-opt strings      driver options for the network</span><br><span class="line">      --ip string               IPv4 address (e.g., 172.30.100.104)</span><br><span class="line">      --ip6 string              IPv6 address (e.g., 2001:db8::33)</span><br><span class="line">      --link list               Add link to another container</span><br><span class="line">      --link-local-ip strings   Add a link-local address for the container</span><br><span class="line">[root@test1 ~]# docker network connect mynet tomcat01</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 测试：连接 mynet 网络的 tomcat-net-01 容器 ping 容器 tomcat01</span> </span><br><span class="line">[root@test1 ~]# docker exec -it tomcat-net-01 ping tomcat01</span><br><span class="line">PING tomcat01 (192.168.0.4) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat01.mynet (192.168.0.4): icmp_seq=1 ttl=64 time=0.607 ms</span><br><span class="line">64 bytes from tomcat01.mynet (192.168.0.4): icmp_seq=2 ttl=64 time=0.166 ms</span><br><span class="line">64 bytes from tomcat01.mynet (192.168.0.4): icmp_seq=3 ttl=64 time=0.154 ms</span><br><span class="line">^C</span><br><span class="line">--- tomcat01 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 5ms</span><br><span class="line">rtt min/avg/max/mdev = 0.154/0.309/0.607/0.210 ms</span><br><span class="line"><span class="meta">#</span><span class="bash"> ping 容器 tomcat02 是不通的，因为容器 tomcat02 没有和 mynet 网络连接</span></span><br><span class="line">[root@test1 ~]# docker exec -it tomcat-net-01 ping tomcat02</span><br><span class="line">ping: tomcat02: Temporary failure in name resolution</span><br><span class="line"><span class="meta">#</span><span class="bash"> 同样 tomcat01 和连接 mynet 网络中的容器也是通的</span></span><br><span class="line">[root@test1 ~]# docker exec -it tomcat01 ping tomcat-net-01</span><br><span class="line">PING tomcat-net-01 (192.168.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=1 ttl=64 time=0.060 ms</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=2 ttl=64 time=0.159 ms</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=3 ttl=64 time=0.159 ms</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=4 ttl=64 time=0.156 ms</span><br><span class="line">^C</span><br><span class="line">--- tomcat-net-01 ping statistics ---</span><br><span class="line">4 packets transmitted, 4 received, 0% packet loss, time 8ms</span><br><span class="line">rtt min/avg/max/mdev = 0.060/0.133/0.159/0.044 ms</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>不同容器之间的关系如下图：<br><img src="https://img-blog.csdnimg.cn/20201009023523713.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 可以看到 mynet 网络中多了一个容器 tomcat01</span></span><br><span class="line">[root@test1 ~]# docker network inspect mynet</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;mynet&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;fb8e5416dc8cbce63f5c589deea58a25ac611492ae706f36c8da689302f7409e&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-04-15T10:26:14.371183053+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;192.168.0.0/16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;192.168.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;54bd4576e8336226977028273ce4daaa27dd2ccceabe33ed1b47e39202f50415&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat01&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;e7d4e54f5c5a85407e1fbfca6ffeb65b7283fa482b0b6f8967721ad4dbc14606&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:04&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.4/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;9cf9e997d05e4061155e3d2f3424bc96bc87de730bd231afcaf3f2f735c11907&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat-net-01&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;14aced5ade4f5e4dcc9b86b129eb42faf6bb7eaf9c48c6e1750b845942204252&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.2/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;f51ac660ce268c0086487756c701629b3bffb0c9ddaab9d0f9713f0194a3e166&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat-net-02&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;4f17b1b0a390df69b6bbec29cdef9a0a3eb5d132ff5b602caf9de290806b2c87&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:03&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.3/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><strong>结论：</strong> 使用 connect 就是将 tomcat01 放到 mynet 下，如果以后想要跨网络操作容器，就需要使用 <code>docker network connect 想要连接的网络名 容器名</code> 命令进行连通。</p>
<h3 id="6-5-实战：部署-redis-集群"><a href="#6-5-实战：部署-redis-集群" class="headerlink" title="6.5 实战：部署 redis 集群"></a>6.5 实战：部署 redis 集群</h3><p>启动 6 个集群，采用 分片+高可用+负载均衡 的方式，三个主节点，三个从节点，实现当一个主节点挂掉以后它的从节点能够替代。如下图所示：<br><img src="https://img-blog.csdnimg.cn/2020100902453233.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0NjIxNQ==,size_16,color_FFFFFF,t_70#pic_center"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 首先把环境清理下</span></span><br><span class="line">docker rm -f $(docker ps -aq)</span><br><span class="line">docker rmi -f $(docker images -aq)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 创建 redis 网卡</span></span><br><span class="line">[root@test1 ~]# docker network create redis --subnet 172.38.0.0/16</span><br><span class="line">a529066f2815a98e01b2b1eac974ede29f2576c4a50ca42e46e15b8703568981</span><br><span class="line">[root@test1 ~]# docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">9c205042ce32   bridge    bridge    local</span><br><span class="line">f6ef41db727a   host      host      local</span><br><span class="line">fb8e5416dc8c   mynet     bridge    local</span><br><span class="line">c2c5f04a92d1   none      null      local</span><br><span class="line">a529066f2815   redis     bridge    local</span><br><span class="line">[root@test1 ~]# docker network inspect redis</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;redis&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;a529066f2815a98e01b2b1eac974ede29f2576c4a50ca42e46e15b8703568981&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-04-15T15:24:39.677639056+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;172.38.0.0/16&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 通过脚本创建 6 个 reids 配置</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> redis的shell脚本，需要的可以自行更改目录</span></span><br><span class="line">for port in $(seq 1 6); \</span><br><span class="line">do \</span><br><span class="line">mkdir -p /home/redis-cluster/redis-$&#123;port&#125;/conf</span><br><span class="line">touch /home/redis-cluster/redis-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">cat &lt;&lt; EOF &gt;&gt;/home/redis-cluster/redis-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">port 6379</span><br><span class="line">bind 0.0.0.0</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">cluster-announce-ip 172.38.0.1$&#123;port&#125;</span><br><span class="line">cluster-announce-port 6379</span><br><span class="line">cluster-announce-bus-port 16379</span><br><span class="line">appendonly yes</span><br><span class="line">EOF</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. 启动 6 个容器</span></span><br><span class="line">[root@test1 ~]# docker run -p 6371:6379 -p 16371:16379 --name redis-1 \</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -v /home/redis-cluster/redis-1/data:/data \</span></span><br><span class="line"><span class="bash">&gt; -v /home/redis-cluster/redis-1/conf/redis.conf:/etc/redis/redis.conf \</span></span><br><span class="line"><span class="bash">&gt; -d --net redis --ip 172.38.0.11 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span></span><br><span class="line">Unable to find image &#x27;redis:5.0.9-alpine3.11&#x27; locally</span><br><span class="line">5.0.9-alpine3.11: Pulling from library/redis</span><br><span class="line">cbdbe7a5bc2a: Pull complete </span><br><span class="line">dc0373118a0d: Pull complete </span><br><span class="line">cfd369fe6256: Pull complete </span><br><span class="line">3e45770272d9: Pull complete </span><br><span class="line">558de8ea3153: Pull complete </span><br><span class="line">a2c652551612: Pull complete </span><br><span class="line">Digest: sha256:83a3af36d5e57f2901b4783c313720e5fa3ecf0424ba86ad9775e06a9a5e35d0</span><br><span class="line">Status: Downloaded newer image for redis:5.0.9-alpine3.11</span><br><span class="line">022bf2a63bbfaa25cacb6755c324770685361e4d5d1b8f2e7cf71a4df910cc84</span><br><span class="line">[root@test1 ~]# docker run -p 6372:6379 -p 16372:16379 --name redis-2 -v /home/redis-cluster/redis-2/data:/data -v /home/redis-cluster/redis-2/conf/redis.conf:/etc/redis/redis.conf -d --net redis --ip 172.38.0.12 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line">c1a0ace1cc7598251fd6944c6db880c49bb17c7d18b6b0af24de9846e7c203f4</span><br><span class="line">[root@test1 ~]# docker run -p 6373:6379 -p 16373:16379 --name redis-3 -v /home/redis-cluster/redis-3/data:/data -v /home/redis-cluster/redis-3/conf/redis.conf:/etc/redis/redis.conf -d --net redis --ip 172.38.0.13 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line">894bf35cd0b94ec3436dd64c970c198876a8434bfb06a15cda36690919550f8e</span><br><span class="line">[root@test1 ~]# docker run -p 6374:6379 -p 16374:16379 --name redis-4 -v /home/redis-cluster/redis-4/data:/data -v /home/redis-cluster/redis-4/conf/redis.conf:/etc/redis/redis.conf -d --net redis --ip 172.38.0.14 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line">95d2dcd3b9e83de188d80b55ebc9d42fea375fd2c87ba0fc6e58018945461577</span><br><span class="line">[root@test1 ~]# docker run -p 6375:6379 -p 16375:16379 --name redis-5 -v /home/redis-cluster/redis-5/data:/data -v /home/redis-cluster/redis-5/conf/redis.conf:/etc/redis/redis.conf -d --net redis --ip 172.38.0.15 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line">97b39026c91cd7ff3cba519a2f577c3f9a19074699c93ea58d44437556d2fa93</span><br><span class="line">[root@test1 ~]# docker run -p 6376:6379 -p 16376:16379 --name redis-6 -v /home/redis-cluster/redis-6/data:/data -v /home/redis-cluster/redis-6/conf/redis.conf:/etc/redis/redis.conf -d --net redis --ip 172.38.0.16 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line">f6c3c1b722e520d54ceae37a8f4cb1d4155dfeaba22ef86ebb28bf6d663e5902</span><br><span class="line">[root@test1 ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE                    COMMAND                  CREATED              STATUS              PORTS                                              NAMES</span><br><span class="line">f6c3c1b722e5   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   11 seconds ago       Up 10 seconds       0.0.0.0:6376-&gt;6379/tcp, 0.0.0.0:16376-&gt;16379/tcp   redis-6</span><br><span class="line">97b39026c91c   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   About a minute ago   Up About a minute   0.0.0.0:6375-&gt;6379/tcp, 0.0.0.0:16375-&gt;16379/tcp   redis-5</span><br><span class="line">95d2dcd3b9e8   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   2 minutes ago        Up 2 minutes        0.0.0.0:6374-&gt;6379/tcp, 0.0.0.0:16374-&gt;16379/tcp   redis-4</span><br><span class="line">894bf35cd0b9   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   2 minutes ago        Up 2 minutes        0.0.0.0:6373-&gt;6379/tcp, 0.0.0.0:16373-&gt;16379/tcp   redis-3</span><br><span class="line">c1a0ace1cc75   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   4 minutes ago        Up 4 minutes        0.0.0.0:6372-&gt;6379/tcp, 0.0.0.0:16372-&gt;16379/tcp   redis-2</span><br><span class="line">022bf2a63bbf   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   17 minutes ago       Up 17 minutes       0.0.0.0:6371-&gt;6379/tcp, 0.0.0.0:16371-&gt;16379/tcp   redis-1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 5. 先进入其中一个 redis 中</span></span><br><span class="line">[root@test1 ~]# docker exec -it redis-1 /bin/sh</span><br><span class="line">/data # redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379 --cluster-replicas 1</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Performing <span class="built_in">hash</span> slots allocation on 6 nodes...</span></span><br><span class="line">Master[0] -&gt; Slots 0 - 5460</span><br><span class="line">Master[1] -&gt; Slots 5461 - 10922</span><br><span class="line">Master[2] -&gt; Slots 10923 - 16383</span><br><span class="line">Adding replica 172.38.0.15:6379 to 172.38.0.11:6379</span><br><span class="line">Adding replica 172.38.0.16:6379 to 172.38.0.12:6379</span><br><span class="line">Adding replica 172.38.0.14:6379 to 172.38.0.13:6379</span><br><span class="line">M: 8b35842b46244f1515adb91ecd13945328454695 172.38.0.11:6379</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">M: 489a44a237443b13e7992b9de8e55e014cb2b697 172.38.0.12:6379</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">M: 667cac456b862898130a219ad577365201b3c073 172.38.0.13:6379</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">S: e1d816d0011049cbbc12b346120e05cb6e82136a 172.38.0.14:6379</span><br><span class="line">   replicates 667cac456b862898130a219ad577365201b3c073</span><br><span class="line">S: f7e4dec850a748ff2d0ad908416ab74f655b0339 172.38.0.15:6379</span><br><span class="line">   replicates 8b35842b46244f1515adb91ecd13945328454695</span><br><span class="line">S: 0d6ff50c517815c5199763727fb34e97ea587d13 172.38.0.16:6379</span><br><span class="line">   replicates 489a44a237443b13e7992b9de8e55e014cb2b697</span><br><span class="line">Can I set the above configuration? (type &#x27;yes&#x27; to accept): yes</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Nodes configuration updated</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Assign a different config epoch to each node</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Sending CLUSTER MEET messages to join the cluster</span></span><br><span class="line">Waiting for the cluster to join</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Performing Cluster Check (using node 172.38.0.11:6379)</span></span><br><span class="line">M: 8b35842b46244f1515adb91ecd13945328454695 172.38.0.11:6379</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: e1d816d0011049cbbc12b346120e05cb6e82136a 172.38.0.14:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 667cac456b862898130a219ad577365201b3c073</span><br><span class="line">S: 0d6ff50c517815c5199763727fb34e97ea587d13 172.38.0.16:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 489a44a237443b13e7992b9de8e55e014cb2b697</span><br><span class="line">S: f7e4dec850a748ff2d0ad908416ab74f655b0339 172.38.0.15:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 8b35842b46244f1515adb91ecd13945328454695</span><br><span class="line">M: 667cac456b862898130a219ad577365201b3c073 172.38.0.13:6379</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 489a44a237443b13e7992b9de8e55e014cb2b697 172.38.0.12:6379</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Check <span class="keyword">for</span> open slots...</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Check slots coverage...</span></span><br><span class="line">[OK] All 16384 slots covered.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入集群</span></span><br><span class="line">/data # redis-cli -c</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看集群信息</span></span><br><span class="line">127.0.0.1:6379&gt; cluster info</span><br><span class="line">cluster_state:ok</span><br><span class="line">cluster_slots_assigned:16384</span><br><span class="line">cluster_slots_ok:16384</span><br><span class="line">cluster_slots_pfail:0</span><br><span class="line">cluster_slots_fail:0</span><br><span class="line">cluster_known_nodes:6</span><br><span class="line">cluster_size:3</span><br><span class="line">cluster_current_epoch:6</span><br><span class="line">cluster_my_epoch:1</span><br><span class="line">cluster_stats_messages_ping_sent:66</span><br><span class="line">cluster_stats_messages_pong_sent:67</span><br><span class="line">cluster_stats_messages_sent:133</span><br><span class="line">cluster_stats_messages_ping_received:62</span><br><span class="line">cluster_stats_messages_pong_received:66</span><br><span class="line">cluster_stats_messages_meet_received:5</span><br><span class="line">cluster_stats_messages_received:133</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看节点信息</span></span><br><span class="line">127.0.0.1:6379&gt; cluster nodes</span><br><span class="line">e1d816d0011049cbbc12b346120e05cb6e82136a 172.38.0.14:6379@16379 slave 667cac456b862898130a219ad577365201b3c073 0 1618473542450 4 connected</span><br><span class="line">8b35842b46244f1515adb91ecd13945328454695 172.38.0.11:6379@16379 myself,master - 0 1618473542000 1 connected 0-5460</span><br><span class="line">0d6ff50c517815c5199763727fb34e97ea587d13 172.38.0.16:6379@16379 slave 489a44a237443b13e7992b9de8e55e014cb2b697 0 1618473542552 6 connected</span><br><span class="line">f7e4dec850a748ff2d0ad908416ab74f655b0339 172.38.0.15:6379@16379 slave 8b35842b46244f1515adb91ecd13945328454695 0 1618473542000 5 connected</span><br><span class="line">667cac456b862898130a219ad577365201b3c073 172.38.0.13:6379@16379 master - 0 1618473542000 3 connected 10923-16383</span><br><span class="line">489a44a237443b13e7992b9de8e55e014cb2b697 172.38.0.12:6379@16379 master - 0 1618473541000 2 connected 5461-10922</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置两个变量</span></span><br><span class="line">127.0.0.1:6379&gt; set a b</span><br><span class="line"><span class="meta">-&gt;</span><span class="bash"> Redirected to slot [15495] located at 172.38.0.13:6379</span></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在另外一个窗口，主机端停止一个容器</span></span><br><span class="line">[root@test1 ~]# docker stop redis-3</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 回到当前窗口，获取其中的一个变量，可看到是从之前删除容器的从容器返回来的信息</span></span><br><span class="line">127.0.0.1:6379&gt; get a</span><br><span class="line"><span class="meta">-&gt;</span><span class="bash"> Redirected to slot [15495] located at 172.38.0.14:6379</span></span><br><span class="line">&quot;b&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看节点的信息，可看到 172.38.0.13 显示 fail，172.38.0.14 显示 master.</span></span><br><span class="line">172.38.0.14:6379&gt; cluster nodes</span><br><span class="line">489a44a237443b13e7992b9de8e55e014cb2b697 172.38.0.12:6379@16379 master - 0 1618473807000 2 connected 5461-10922</span><br><span class="line">0d6ff50c517815c5199763727fb34e97ea587d13 172.38.0.16:6379@16379 slave 489a44a237443b13e7992b9de8e55e014cb2b697 0 1618473807595 6 connected</span><br><span class="line">667cac456b862898130a219ad577365201b3c073 172.38.0.13:6379@16379 master,fail - 1618473629783 1618473629269 3 connected</span><br><span class="line">8b35842b46244f1515adb91ecd13945328454695 172.38.0.11:6379@16379 master - 0 1618473807999 1 connected 0-5460</span><br><span class="line">e1d816d0011049cbbc12b346120e05cb6e82136a 172.38.0.14:6379@16379 myself,master - 0 1618473807000 7 connected 10923-16383</span><br><span class="line">f7e4dec850a748ff2d0ad908416ab74f655b0339 172.38.0.15:6379@16379 slave 8b35842b46244f1515adb91ecd13945328454695 0 1618473807595 1 connected </span><br><span class="line"></span><br></pre></td></tr></table></figure>
    </div>

    
    
    

      <div>
        
          <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>

        
      </div>
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Crystal
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://crystal1213.github.io/posts/4126800539/" title="Docker">https://crystal1213.github.io/posts/4126800539/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Docker/" rel="tag"><i class="fa fa-tag"></i> Docker</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/posts/1836411548/" rel="prev" title="Kubernetes-K8s">
      <i class="fa fa-chevron-left"></i> Kubernetes-K8s
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Docker-%E6%A6%82%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text">1 Docker 概述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E5%9F%BA%E6%9C%AC%E8%AE%A4%E8%AF%86"><span class="nav-number">1.1.</span> <span class="nav-text">1.1 基本认识</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-Docker-%E5%AE%89%E8%A3%85"><span class="nav-number">1.2.</span> <span class="nav-text">1.2 Docker 安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-Docker-%E5%8E%9F%E7%90%86"><span class="nav-number">1.3.</span> <span class="nav-text">1.3 Docker 原理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-docker-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">2.</span> <span class="nav-text">2 docker 常用命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E5%B8%AE%E5%8A%A9%E5%91%BD%E4%BB%A4"><span class="nav-number">2.1.</span> <span class="nav-text">2.1 帮助命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E9%95%9C%E5%83%8F%E5%91%BD%E4%BB%A4"><span class="nav-number">2.2.</span> <span class="nav-text">2.2 镜像命令</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%AF%E9%80%89%E9%A1%B9%EF%BC%8C%E9%80%9A%E8%BF%87-STARS-%E6%9D%A5%E8%BF%87%E6%BB%A4"><span class="nav-number"></span> <span class="nav-text">可选项，通过 STARS 来过滤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E5%AE%B9%E5%99%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">0.1.</span> <span class="nav-text">2.3 容器命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-%E5%B8%B8%E7%94%A8%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4"><span class="nav-number">0.2.</span> <span class="nav-text">2.4 常用其他命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%B0%8F%E7%BB%93"><span class="nav-number">0.3.</span> <span class="nav-text">2.5 常用命令小结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-%E7%BB%83%E4%B9%A0"><span class="nav-number">0.4.</span> <span class="nav-text">2.6 练习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-7-%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="nav-number">0.5.</span> <span class="nav-text">2.7 可视化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Docker-%E9%95%9C%E5%83%8F%E8%AE%B2%E8%A7%A3"><span class="nav-number">1.</span> <span class="nav-text">3 Docker 镜像讲解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-Docker-%E9%95%9C%E5%83%8F%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-number">1.1.</span> <span class="nav-text">3.1 Docker 镜像是什么</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-Docker-%E9%95%9C%E5%83%8F%E5%8A%A0%E8%BD%BD%E5%8E%9F%E7%90%86"><span class="nav-number">1.2.</span> <span class="nav-text">3.2 Docker 镜像加载原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E5%88%86%E5%B1%82%E7%90%86%E8%A7%A3"><span class="nav-number">1.3.</span> <span class="nav-text">3.3 分层理解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-commit-%E9%95%9C%E5%83%8F"><span class="nav-number">1.4.</span> <span class="nav-text">3.4 commit 镜像</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="nav-number">2.</span> <span class="nav-text">4 容器数据卷</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E4%BB%80%E4%B9%88%E6%98%AF%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="nav-number">2.1.</span> <span class="nav-text">4.1 什么是容器数据卷</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E4%BD%BF%E7%94%A8%E4%B9%A6%E5%8D%B7"><span class="nav-number">2.2.</span> <span class="nav-text">4.2 使用书卷</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-%E5%AE%9E%E6%88%98%EF%BC%9A%E5%AE%89%E8%A3%85-MySQL"><span class="nav-number">2.3.</span> <span class="nav-text">4.3 实战：安装 MySQL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-%E5%85%B7%E5%90%8D%E6%8C%82%E8%BD%BD%E5%92%8C%E5%8C%BF%E5%90%8D%E6%8C%82%E8%BD%BD"><span class="nav-number">2.4.</span> <span class="nav-text">4.4 具名挂载和匿名挂载</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-DockerFile"><span class="nav-number">3.</span> <span class="nav-text">5 DockerFile</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-%E5%88%9D%E8%AF%86-DockerFile"><span class="nav-number">3.1.</span> <span class="nav-text">5.1 初识 DockerFile</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-%E6%95%B0%E6%8D%AE%E5%8D%B7%E5%AE%B9%E5%99%A8"><span class="nav-number">3.2.</span> <span class="nav-text">5.2 数据卷容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-DockerFile-%E4%BB%8B%E7%BB%8D"><span class="nav-number">3.3.</span> <span class="nav-text">5.3 DockerFile 介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-DockerFile-%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B"><span class="nav-number">3.4.</span> <span class="nav-text">5.4 DockerFile 构建过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-5-DockerFile-%E7%9A%84%E6%8C%87%E4%BB%A4"><span class="nav-number">3.5.</span> <span class="nav-text">5.5 DockerFile 的指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-6-%E5%AE%9E%E6%88%98%E6%B5%8B%E8%AF%95%EF%BC%9A%E6%9E%84%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84-Centos"><span class="nav-number">3.6.</span> <span class="nav-text">5.6 实战测试：构建自己的 Centos</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-7-%E5%AE%9E%E6%88%98%EF%BC%9A%E4%BD%BF%E7%94%A8-DockerFile-%E5%88%B6%E4%BD%9C-Tomcat-%E9%95%9C%E5%83%8F"><span class="nav-number">3.7.</span> <span class="nav-text">5.7 实战：使用 DockerFile 制作 Tomcat 镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-8-Docker-%E6%89%80%E6%9C%89%E6%B5%81%E7%A8%8B%E5%B0%8F%E7%BB%93"><span class="nav-number">3.8.</span> <span class="nav-text">5.8 Docker 所有流程小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-Docker-%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0"><span class="nav-number">4.</span> <span class="nav-text">6 Docker 网络学习</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-%E7%90%86%E8%A7%A3-Docker0"><span class="nav-number">4.1.</span> <span class="nav-text">6.1 理解 Docker0</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-%E2%80%93link-%E5%AE%B9%E5%99%A8%E4%BA%92%E8%81%94%EF%BC%88%E4%BA%86%E8%A7%A3%E5%8D%B3%E5%8F%AF%EF%BC%89"><span class="nav-number">4.2.</span> <span class="nav-text">6.2 –link 容器互联（了解即可）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C"><span class="nav-number">4.3.</span> <span class="nav-text">6.3 自定义网络</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-4-%E7%BD%91%E7%BB%9C%E8%BF%9E%E9%80%9A"><span class="nav-number">4.4.</span> <span class="nav-text">6.4 网络连通</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-5-%E5%AE%9E%E6%88%98%EF%BC%9A%E9%83%A8%E7%BD%B2-redis-%E9%9B%86%E7%BE%A4"><span class="nav-number">4.5.</span> <span class="nav-text">6.5 实战：部署 redis 集群</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Crystal"
      src="/images/head.gif">
  <p class="site-author-name" itemprop="name">Crystal</p>
  <div class="site-description" itemprop="description">Guard heart, everything flows from it.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">21</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Crystal1213" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Crystal1213" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://crystal.blog.csdn.net/" title="CSDN → https:&#x2F;&#x2F;crystal.blog.csdn.net&#x2F;" rel="noopener" target="_blank"><i class="fa fa-copyright fa-fw"></i>CSDN</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://leetcode-cn.com/u/crystal_yyf/" title="LeetCode → https:&#x2F;&#x2F;leetcode-cn.com&#x2F;u&#x2F;crystal_yyf&#x2F;" rel="noopener" target="_blank"><i class="fa fa-code fa-fw"></i>LeetCode</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/GodLoveCrystal" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;GodLoveCrystal" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2020 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Crystal</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">169k</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>
